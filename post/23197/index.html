<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SHCTF2024 WriteUp | dawn1ight çš„å°å±‹</title><meta name="author" content="dawn1ight"><meta name="copyright" content="dawn1ight"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="SHCTF2024 WriteUp Author: dawn1ight å¼€å§‹ä»¥ä¸ºæ˜¯æ–°ç”Ÿèµ›ï¼Œåé¢éš¾åº¦æ˜æ˜¾ä¸Šå‡ è¿™é‡Œè®°å½•ä¸€ä¸‹ä¸€äº›å€¼å¾—å­¦ä¹ çš„é¢˜ç›® æœ‰äº›æ˜¯æ¿å­é¢˜ï¼Œä¹Ÿè®°å½•ä¸€ä¸‹ï¼Œç°åœ¨å¹´çºªå¤§äº†å¥å¿˜ğŸ˜… Challenges: https:&#x2F;&#x2F;shc.tf&#x2F; References:  SHCTF2024-week1-crypto&amp;å…¶ä»– - Naby - åšå®¢å›­ SHCTF-2024-Week2 å®˜æ–¹WP">
<meta property="og:type" content="article">
<meta property="og:title" content="SHCTF2024 WriteUp">
<meta property="og:url" content="https://dawn1ight.github.io/post/23197/index.html">
<meta property="og:site_name" content="dawn1ight çš„å°å±‹">
<meta property="og:description" content="SHCTF2024 WriteUp Author: dawn1ight å¼€å§‹ä»¥ä¸ºæ˜¯æ–°ç”Ÿèµ›ï¼Œåé¢éš¾åº¦æ˜æ˜¾ä¸Šå‡ è¿™é‡Œè®°å½•ä¸€ä¸‹ä¸€äº›å€¼å¾—å­¦ä¹ çš„é¢˜ç›® æœ‰äº›æ˜¯æ¿å­é¢˜ï¼Œä¹Ÿè®°å½•ä¸€ä¸‹ï¼Œç°åœ¨å¹´çºªå¤§äº†å¥å¿˜ğŸ˜… Challenges: https:&#x2F;&#x2F;shc.tf&#x2F; References:  SHCTF2024-week1-crypto&amp;å…¶ä»– - Naby - åšå®¢å›­ SHCTF-2024-Week2 å®˜æ–¹WP">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/10/05/fvB8o4VdOgXwIcU.png">
<meta property="article:published_time" content="2024-10-04T16:00:00.000Z">
<meta property="article:modified_time" content="2024-10-23T03:36:13.212Z">
<meta property="article:author" content="dawn1ight">
<meta property="article:tag" content="WriteUp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/10/05/fvB8o4VdOgXwIcU.png"><link rel="shortcut icon" href="https://s2.loli.net/2024/06/09/efzNlYosV9I7DTd.jpg"><link rel="canonical" href="https://dawn1ight.github.io/post/23197/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?[object Object]";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SHCTF2024 WriteUp',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-23 11:36:13'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/loading.css"><link rel="stylesheet" href="/css/progress_bar.css"><link rel="stylesheet" href="/css/scrollbar.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="dawn1ight çš„å°å±‹" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2024/06/09/8Hyr97a4VnGmL5K.jpg" onerror="onerror=null;src='https://s2.loli.net/2024/06/09/wNr574gd2t1MYzh.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> åšå®¢</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> ç”Ÿæ´»</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/share/"><i class="fa-fw fa fa-share-alt"></i><span> åˆ†äº«</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> å½±è§†</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> ä¹¦æ¶</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2024/06/09/l9xkjgDWpeo4mRE.png')"><nav id="nav"><span id="blog-info"><a href="/" title="dawn1ight çš„å°å±‹"><img class="site-icon" src="https://s2.loli.net/2024/06/09/efzNlYosV9I7DTd.jpg"/><span class="site-name">dawn1ight çš„å°å±‹</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> åšå®¢</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> ç”Ÿæ´»</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/share/"><i class="fa-fw fa fa-share-alt"></i><span> åˆ†äº«</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> å½±è§†</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> ä¹¦æ¶</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SHCTF2024 WriteUp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-10-04T16:00:00.000Z" title="å‘è¡¨äº 2024-10-05 00:00:00">2024-10-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-10-23T03:36:13.212Z" title="æ›´æ–°äº 2024-10-23 11:36:13">2024-10-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Crypto/">Crypto</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">3.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>19åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SHCTF2024 WriteUp"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="shctf2024-writeup"><a class="markdownIt-Anchor" href="#shctf2024-writeup"></a> SHCTF2024 WriteUp</h1>
<p>Author: <em>dawn1ight</em></p>
<p>å¼€å§‹ä»¥ä¸ºæ˜¯æ–°ç”Ÿèµ›ï¼Œåé¢éš¾åº¦æ˜æ˜¾ä¸Šå‡</p>
<p>è¿™é‡Œè®°å½•ä¸€ä¸‹ä¸€äº›å€¼å¾—å­¦ä¹ çš„é¢˜ç›®</p>
<p>æœ‰äº›æ˜¯æ¿å­é¢˜ï¼Œä¹Ÿè®°å½•ä¸€ä¸‹ï¼Œç°åœ¨å¹´çºªå¤§äº†å¥å¿˜ğŸ˜…</p>
<p>Challenges: <a target="_blank" rel="noopener" href="https://shc.tf/">https://shc.tf/</a></p>
<p>References:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/naby/p/18453402">SHCTF2024-week1-crypto&amp;å…¶ä»– - Naby - åšå®¢å›­</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/33nH9RHgr-WKun_3s-VDBQ">SHCTF-2024-Week2 å®˜æ–¹WP</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/naby/p/18494522">SHCTF2024-week3-Crypto - Naby - åšå®¢å›­</a></li>
</ul>
<hr />
<h2 id="week1-baby_mod"><a class="markdownIt-Anchor" href="#week1-baby_mod"></a> [Week1] baby_mod</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">777</span>)</span><br><span class="line">t = getPrime(<span class="number">777</span>)</span><br><span class="line">tmp = getPrime(<span class="number">15</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;<span class="built_in">pow</span>(m,e,n)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;leak = <span class="subst">&#123;p*r-q*t-tmp&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;r = <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;t = <span class="subst">&#123;t&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = 45437656714471121627138355157760519584383877487083560638903569231003753429372236070673691857077169730892603519190227245821716759904875309795146278716052074220641458531647162288390402966859091110298425439892694611261350164211397322166134468062254148404013023967282115714260566980579790675450977684598154683785</span></span><br><span class="line"><span class="string">leak = 917729846530514329091476751337548142663910269694651103714041735452546026352121711031281639288281121290785017229906183907137403178781576858736428178204769128767097523395085267085771922696024764050979069087497065064591318989089775212833290963557483734212236438863620201740169796194249006164247654534569614690567400813756683870275745415498464733530190060496080241170104695379710002184233081</span></span><br><span class="line"><span class="string">r = 793229623087740428917628841295655826564196384346081225806981956029244585596768549762915374835268249941097061878943697142938918149057462225787338641617803276170476918982550729029779739695910685814521000495703548880378158347199461860861</span></span><br><span class="line"><span class="string">t = 744863076918695565453771645986298395285065781545937584151938034629094359251294022583665909210010813743205258526086574787553912036903279151072458100492653680636375191905874208421015881385428664217006240902142289558937906046107628918859</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°é¢˜ç›®æ‰“ç®—ç›´æ¥çˆ†ç ´<code>tmp</code>è§£æ–¹ç¨‹ç»„çš„</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>l</mi><mi>e</mi><mi>a</mi><mi>k</mi><mo>=</mo><mi>p</mi><mo>âˆ—</mo><mi>r</mi><mo>âˆ’</mo><mi>q</mi><mo>âˆ—</mo><mi>t</mi><mo>âˆ’</mo><mi>t</mi><mi>m</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>âˆ—</mo><mi>q</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
leak = p*r-q*t-tmp \\
n = p*q
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>å‘ç°é¢˜ç›®æ²¡æœ‰ç»™<code>n</code></p>
<p>è¿™é‡Œçš„<code>r</code>å’Œ<code>t</code>éƒ½å¤§äº<code>p</code> <code>q</code>ï¼Œæ‰€ä»¥ç›¸äº’å–æ¨¡å¾—</p>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: gather* at position 7: \begin{Ì²gÌ²aÌ²tÌ²hÌ²eÌ²rÌ²*Ì²}Ì²
leak \mod r = â€¦'>\begin{gather*}
leak \mod r = p*r-q*t-tmp \mod r \\
leak + tmp \mod r = -q*t \mod r \\
q = (leak + tmp) * (-t)^{-1} \mod r
\end{gather*}
</p>
<p>åŒç†ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mo>=</mo><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>a</mi><mi>k</mi><mo>+</mo><mi>t</mi><mi>m</mi><mi>p</mi><mo stretchy="false">)</mo><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>r</mi><msup><mo stretchy="false">)</mo><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>t</mi></mrow><annotation encoding="application/x-tex">p = (leak+tmp)*(r)^{-1} \mod t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span></span></span></span></span></p>
<p>exp : <a target="_blank" rel="noopener" href="https://www.cnblogs.com/naby/p/18453402">SHCTF2024-week1-crypto&amp;å…¶ä»– - Naby - åšå®¢å›­ (cnblogs.com)</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">c = <span class="number">71234358574362873102364773802615022440394390446444390689714741290273256497624990382730338332158663555287988268595847316457126725465934797593513638874080685234812619607085870642413735129064333224013231845589579968352149987746733082038743926312136617735737911790112644979985292337941440005746915062896129072777</span></span><br><span class="line">leak = <span class="number">2217488402566151788696168373426094740519351868786430669391214527591322807736221920621550927091543088314007690386894840897074614743933753244173854967425133479984993125811498747715413075715060875227040103463552575330232198985262343584404068367662218021241516914268202429825385451154716855517698999217286233212883976929431520295647139310474770195069360507813140653593200423906263689190196941</span></span><br><span class="line">r = <span class="number">646318094023677204527871439846728286610915145770782515880490500338118827547552454143674595295593483857447183764297927877955433524028721434976463867920536240963456378175496414765880178663672652425288097309012713851733051985028662176767</span></span><br><span class="line">t = <span class="number">411152195791514027140198841770649225930812047768916179668614369267330226695072559818563655559461575922343428542543751957306358237424055209296982269437988221098480220776423566575802287022940784911752257706236556835428048277615354900397</span></span><br><span class="line"> </span><br><span class="line">tmp=<span class="number">1</span>&lt;&lt;<span class="number">14</span></span><br><span class="line">tmp=next_prime(tmp)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="built_in">int</span>(tmp).bit_length()==<span class="number">15</span>:</span><br><span class="line">    x=leak+tmp</span><br><span class="line"> </span><br><span class="line">    pr=x%t</span><br><span class="line">    p=pr*invert(r,t)%t</span><br><span class="line"> </span><br><span class="line">    qt=x%r</span><br><span class="line">    q=qt*invert(-t,r)%r</span><br><span class="line">    </span><br><span class="line">    flag=long_to_bytes(<span class="built_in">pow</span>(c,invert(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)),p*q))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;SHCTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line">    tmp=next_prime(tmp)</span><br><span class="line"><span class="comment">#b&#x27;SHCTF&#123;004df497-194a-4adb-a675-498ff80946a4&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="week1-d_known"><a class="markdownIt-Anchor" href="#week1-d_known"></a> [Week1] d_known</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = next_prime(p)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>) * (q-<span class="number">1</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = 14754616342385889226523163233456626568583338878447677477264123879922299212851590995108562476976996490186514544769418956576341111197302389433443137591895978122078984343835532649853533922077743108464133594580310257053247234842242258806721334957785422917026938427617572724815559629348765182822868167461354410531375298557821414707229842536823730755256236156265393650672208226959679400363171690605392134085613189512188350291521387717943632410029686096047041138679963736410397635219464470679503925465247560375777761232386822645099986930268675702669789410403561035948651071816164753385550305724927173844685486745218901991290</span></span><br><span class="line"><span class="string">d = 1584002925248818192743719398743841252208212886071330412633566311356101418040520835843589445425449520698531124917534031266832064627999754033796468790621713333536602778546404704190223202391198167915559642317735981777155889248989261442106757720828921863135304104689505591364608198280118905994363913345364214854979318711326654443828720544265881180686096392455926490169653966632767375383674720009286851902968122706469860651407253475439283722507941794337069535019618439934799606721929935849809583256872132873264812878836099510558296186289301055199336236663148519774947000850709818659346623288768867037411488897123286770273</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ¬¡çœ‹åˆ°å·²çŸ¥<code>e</code> <code>c</code> <code>d</code>ï¼ŒæœªçŸ¥<code>n</code>çš„ï¼Œé¡ºæ‰‹è®°å½•ä¸€ä¸‹</p>
<p>å› ä¸º  $$eâˆ—d=1+k(pâˆ’1)âˆ—(qâˆ’1)$$</p>
<p>å…¶ä¸­e.bit_length = 17 , d.bit_length = 2044ï¼Œe*d.bit_length = 17+2044=2061</p>
<p>æ‰€ä»¥k.bit_length = 2061-2048 = 13</p>
<p>kçš„ä½æ•°è¾ƒå°ï¼Œç›´æ¥çˆ†ç ´ï¼Œå¾—åˆ°kåï¼Œå¼€æ ¹æ‰¾<code>p</code> <code>q</code></p>
<p>exp: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/naby/p/18453402">SHCTF2024-week1-crypto&amp;å…¶ä»– - Naby - åšå®¢å›­ (cnblogs.com)</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>*</span><br><span class="line">c = <span class="number">6732251865518539816164424072881268319031331097652330813280683433357801335392912177839752934223666820817426632127352928430012362924774912477109386830642999347655174646486445749282081282131296883166737218186933150962954375021792510359249354608393910760866285720493437099307009772363622740758020450195058117428033257931181355503862561253831338555714889714354329478309157001314105412865222237034290374400091189055727376519273128476126263310458266841590313023188003911952343519869473445661561073623892887752662030827442327135879769080060164402731521556649771103135168057114303776160563813899618546785999749664177453632113</span></span><br><span class="line">d = <span class="number">11371580488052460364061084069704641839174413746220695175554663449524234948335256195937545669217400540775148109520252191887923992650699774976840228129947067273971611578960093458221417649211802998948255284549550327209608951277790691750176306647013841775784127208779682066022248206322448435923296521731067094090722931128289230166731316016559509613812382769439697093763600981220856565912350418801087801159700549049260015100996680924659351921989952140635505978192913908332000472530408585162635570201105801365273780636017489787165910874274076972387901429211792329811097435011802258823111183660801103517212211007626963313585</span></span><br><span class="line"> </span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line"> </span><br><span class="line">p_bits=<span class="number">1024</span></span><br><span class="line">q_bits=<span class="number">1024</span></span><br><span class="line"> </span><br><span class="line">k_phi = e*d -<span class="number">1</span></span><br><span class="line">pphi = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(e,<span class="number">2</span>,-<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> k_phi % k == <span class="number">0</span>:</span><br><span class="line">        tmp = k_phi // k</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(tmp).bit_length()==p_bits+q_bits:</span><br><span class="line">            pphi.append(tmp)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pphi))</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> pphi:</span><br><span class="line">    pp=iroot(k,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    pp=next_prime(pp)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        flag=long_to_bytes(<span class="built_in">pow</span>(c,invert(e,pp-<span class="number">1</span>),pp))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;SHCTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            exit()</span><br><span class="line">        pp=next_prime(pp)</span><br><span class="line"><span class="comment">#b&#x27;SHCTF&#123;a47dee42-f097-4aa8-b0a4-5183df80b230&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="week2-wordeå¾ˆå¤§"><a class="markdownIt-Anchor" href="#week2-wordeå¾ˆå¤§"></a> [Week2] wordeå¾ˆå¤§</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = getPrime(<span class="number">200</span>)</span><br><span class="line">d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">dp = d % (p-<span class="number">1</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;dp = <span class="subst">&#123;dp&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 88542777790587575958856535465544599238988794938932395236356028878208693584553921119734886663063387114985956647258226878203724318615294722034106396937919235154861105785869874151270067925203729926989428004839944095750101187948993624810926392104761625157561710259470296817872143022024487507072861006495754688653</span></span><br><span class="line"><span class="string">c = 4141222246815895616291413394343312964175715946241779591801652809315536569381063955911406475498467635919469098028234013454537502595095924767681446516595753207198369151203658212276072550342924879998539629809265836285575387813466965366640792684375303199812785289313990143066954674834496302632946904071326609297</span></span><br><span class="line"><span class="string">e = 1245551412820870740174723390060313799694721899963655821368021</span></span><br><span class="line"><span class="string">dp = 3987147738497114215543342475012772407316738649850763986799558233896894884270854903426184789815541134132666857825062494954944564442089304100964792551427901</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€çœ¼çœ‹ï¼šdpæ³„éœ²ï¼Œç›´æ¥ä¸Šè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"></span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">dp = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">	<span class="keyword">if</span>(e*dp%x==<span class="number">1</span>):</span><br><span class="line">		p=(e*dp-<span class="number">1</span>)//x+<span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span>(n%p!=<span class="number">0</span>):</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		q=n//p</span><br><span class="line">		phin=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">		d=gp.invert(e, phin)</span><br><span class="line">		m=gp.powmod(c, d, n)</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">len</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])%<span class="number">2</span>==<span class="number">1</span>):</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;--------------&#x27;</span>)</span><br><span class="line">		<span class="built_in">print</span>(m)</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure>
<p>ä»£ç è·‘èµ·æ¥å‘ç°é—®é¢˜ï¼š<code>e</code>å¤ªå¤§äº†ï¼Œ<code>for x in range(1, e):</code>å¾ªç¯ä¸äº†</p>
<p>è¿™é‡Œå¤ä¹ ä¸€ä¸‹dpæ³„éœ²çš„æ¨å¯¼ï¼š<a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/06/crypto-RSA/#%E7%BB%99n-e-dp-c">RSA | Lazzaro</a></p>
<center>
	<img src="https://s2.loli.net/2024/10/22/wPOuf9SmZpCsVoe.png"/>
</center>
<p>[å®˜æ–¹WP](<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/33nH9RHgr-WKun_3s-VDBQ">SHCTF-2024-Week2 å®˜æ–¹WP</a>)ä¸­ç»™å‡ºäº†å¦ä¸€ç§æ€è·¯ï¼š</p>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: gather* at position 7: \begin{Ì²gÌ²aÌ²tÌ²hÌ²eÌ²rÌ²*Ì²}Ì²
d_p \equiv d \â€¦'>\begin{gather*}
d_p \equiv d \mod (p-1) \\
ed \equiv 1 \mod (p-1)(q-1) \\
m^{ed_p}\mod n \equiv m^{ed\mod (p-1)} \mod p
\equiv m^{1+k(p-1)}\mod p \\
Fermat&#039;s\;little\;theorem: a^{p-1} \equiv 1 \mod p \\
\therefore m^{1+k(p-1)}\mod p \equiv m \mod p \\
\therefore m^{ed_p}\mod n - m \equiv 0 \mod p \\
p = gcd(m^{ed_p}\mod n - m , n)
\end{gather*}
</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_dp_leak</span>(<span class="params">e,dp,n,c</span>):</span><br><span class="line">    p = gmpy2.gcd(<span class="built_in">pow</span>(<span class="number">5</span>,e*dp,n)-<span class="number">5</span>,n)</span><br><span class="line">    q = n//p</span><br><span class="line">    phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = gmpy2.invert(e,phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">64921145375403083545531864956984072151341856682908111104267811008333409469629440124743589471022387528791249789776590881987854906662741019934835451842451919000617925805744632898434110555454137681326076564563593722826588259739946684132723368750061113163201190149766894752415770470935877082883818815783228793301</span></span><br><span class="line">c = <span class="number">44359153953700249051087265515623429893507549101698748624219639421725336531447633500661794130815898489480094607965932371706122863829042269163279628456581736821883648892589019882848750637212268727873179153330759038867740405957550265592570772766459698597324782564295219919626040670464946117978529709691316881784</span></span><br><span class="line">e = <span class="number">1039743120668324617408742378768011653641207981199791545288831</span></span><br><span class="line">dp = <span class="number">8095244708261074732722010639332938624538458336137147330884467084239259958828296552002478065663880970649018267223959758006546150783644433676150589502506131</span></span><br><span class="line">flag = solve_dp_leak(e,dp,n,c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="week2-pading"><a class="markdownIt-Anchor" href="#week2-pading"></a> [Week2] pading</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">flag = <span class="string">b&#x27;SHCTF&#123;********&#125;&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">39</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x3</span></span><br><span class="line">pad = <span class="string">b&#x27;a_easy_problem&#x27;</span></span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag + pad),e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 91962111715720628931777486647875963597059245014993834637215306985302903621464344605955155370348537698530851713548856588595357527678260117697489817054763356250308965979522594496834705694372742092292311232828638584584609342951267373570856946545879808444285055808517549024876269033273404965254049332343508104863</span></span><br><span class="line"><span class="string">c = 835987509864121006527888651109319907471805581850280147445733978677695297628994680781831454726352944669970247353856138381638935782695381894498099459107034055303822413288778616502133532974585719609649449865222654363240517858566923788177475848463204393365238566405496963006673163725540787729555001445755141253</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨å°<code>e</code>ä¸‹ï¼ŒçŸ¥é“mçš„ä½ä½</p>
<p>è¿™ç§çŸ¥é“é«˜ä½ä½çš„åŸºæœ¬éƒ½æ˜¯coppersmithçš„åº”ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">n = <span class="number">101194231761192803646875794770841105131876105333404505987513576849142365482512109876401629071314564545841743473668262668053559550015874646299248232349238400201145583346187330958825878235324968882794481192056169683711007095999439320830763275487477094590502701333963154552470777678553556993349171608134555815527</span></span><br><span class="line">c = <span class="number">54067443511581567434123971345564905390315631873898717856316286990552318113901362505672245448553258416669456882532743580961176229271906817289588426185966004215569829572814038485471312399063659287164712291139771809733004385057875146223151700601326161190474536508680332925332614914475852998934930375151571163346</span></span><br><span class="line">e = <span class="number">0x3</span></span><br><span class="line">pad = <span class="string">b&#x27;a_easy_problem&#x27;</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (x * <span class="number">256</span> ** <span class="built_in">len</span>(pad) + libnum.s2n(pad)) ** e - c</span><br><span class="line"></span><br><span class="line">f = f.monic()</span><br><span class="line">root = f.small_roots(X=<span class="number">2</span> ** (<span class="number">39</span> * <span class="number">8</span>),beta=<span class="number">0.9</span>,epsilon=<span class="number">0.03</span>)</span><br><span class="line"><span class="built_in">print</span>(root)</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(root[<span class="number">0</span>])))</span><br></pre></td></tr></table></figure>
<p>å‚æ•°çš„è€ƒè™‘ï¼š</p>
<blockquote>
<p>padæˆ‘ä»¬æ˜¯çŸ¥é“çš„ï¼Œä¸”å‘Šè¯‰äº†æˆ‘ä»¬flagçš„ä½æ•°ä¸º39ï¼Œ39 * 8 = 312ï¼Œeæ¬¡æ–¹ä¸º312* 3 = 936ï¼Œ</p>
<p>è€Œnçš„ä½æ•°ä¸º1024ï¼Œ312çš„flagç›¸å¯¹äº1024çš„næ¥è¯´æ˜¯å°å€¼ï¼Œå¯ç”¨coppersmithçš„æ–¹æ³•æ±‚å¾—ï¼Œ</p>
<p>betaçš„å€¼ä¾æ®912/1024=0.91å–æ•´ä¸º0.9ï¼Œepslilonçš„å€¼æ…¢æ…¢æ”¾å°</p>
</blockquote>
<h2 id="week2-er"><a class="markdownIt-Anchor" href="#week2-er"></a> [Week2] E&amp;R</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">flag = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line">l = <span class="built_in">len</span>(flag)</span><br><span class="line">m1 = bytes_to_long(flag[:l//<span class="number">2</span>])</span><br><span class="line">m2 = bytes_to_long(flag[l//<span class="number">2</span>:])</span><br><span class="line"><span class="comment">#RSA</span></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">r_q = <span class="built_in">int</span>(<span class="built_in">bin</span>(q)[<span class="number">2</span>:][::-<span class="number">1</span>] , <span class="number">2</span>)</span><br><span class="line">leak = p ^^ r_q</span><br><span class="line">c = <span class="built_in">pow</span>(m2,e,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ECC</span></span><br><span class="line">E = EllipticCurve(Zmod(n),[<span class="number">114514</span>,<span class="number">1919810</span>])</span><br><span class="line">G = E.lift_x(Integer(m1))</span><br><span class="line">P = G * e</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;leak = <span class="subst">&#123;leak&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;P = <span class="subst">&#123;P&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># leak = 5599968251197363876087002284371721787318931284225671549507477934076746561842</span></span><br><span class="line"><span class="comment"># n = 7120275986401660066259983193598830554385933355254283093021239164350142898387660104515624591378875067038235085428170557400012848874756868985306042421950909</span></span><br><span class="line"><span class="comment"># c = 6803450117490196163076010186755045681029929816618361161925865477601994608941714788803007124967390157378525581080320415602012078322064392991884070073083436</span></span><br><span class="line"><span class="comment"># P = (4143131125485719352848137000299706175276016714942734255688381872061184989156686585992844083387698688432978380177564346382756951426943827434190895490233627 : 3879946878859691332371384275396678851932267609535096278038417524609690721322205780110680003522999409696718745532857001461869452116434787256032366267905519 : 1)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¤ä¹ ä¸€ä¸‹RSAå‰ªæ</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://sch01ar.github.io/2023/11/07/%E5%89%AA%E6%9E%9D/">ä¸€äº›å…³äºp^qé—®é¢˜å‰ªæç®—æ³• - Yâ€™s blog</a></li>
<li><a target="_blank" rel="noopener" href="https://tangcuxiaojikuai.xyz/post/342113ee.html">Cryptoè¶£é¢˜-å‰ªæ | ç³–é†‹å°é¸¡å—çš„blog</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">pxorq = <span class="number">5599968251197363876087002284371721787318931284225671549507477934076746561842</span></span><br><span class="line">n = <span class="number">7120275986401660066259983193598830554385933355254283093021239164350142898387660104515624591378875067038235085428170557400012848874756868985306042421950909</span></span><br><span class="line">c = <span class="number">6803450117490196163076010186755045681029929816618361161925865477601994608941714788803007124967390157378525581080320415602012078322064392991884070073083436</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">pxorq = <span class="built_in">str</span>(<span class="built_in">bin</span>(pxorq)[<span class="number">2</span>:]).zfill(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">ph, qh, pl, ql</span>):</span><br><span class="line">    l = <span class="built_in">len</span>(ph)</span><br><span class="line">    tmp0 = ph + (<span class="number">256</span> - <span class="number">2</span> * l) * <span class="string">&quot;0&quot;</span> + pl</span><br><span class="line">    tmp1 = ph + (<span class="number">256</span> - <span class="number">2</span> * l) * <span class="string">&quot;1&quot;</span> + pl</span><br><span class="line">    tmq0 = qh + (<span class="number">256</span> - <span class="number">2</span> * l) * <span class="string">&quot;0&quot;</span> + ql</span><br><span class="line">    tmq1 = qh + (<span class="number">256</span> - <span class="number">2</span> * l) * <span class="string">&quot;1&quot;</span> + ql</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">int</span>(tmp0, <span class="number">2</span>) * <span class="built_in">int</span>(tmq0, <span class="number">2</span>) &gt; n):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">int</span>(tmp1, <span class="number">2</span>) * <span class="built_in">int</span>(tmq1, <span class="number">2</span>) &lt; n):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">int</span>(pl, <span class="number">2</span>) * <span class="built_in">int</span>(ql, <span class="number">2</span>) % (<span class="number">2</span> ** (l - <span class="number">1</span>)) != n % (<span class="number">2</span> ** (l - <span class="number">1</span>))):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l == <span class="number">128</span>):</span><br><span class="line">        pp0 = <span class="built_in">int</span>(tmp0, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> (n % pp0 == <span class="number">0</span>):</span><br><span class="line">            pf = pp0</span><br><span class="line">            qf = n // pp0</span><br><span class="line">            <span class="built_in">print</span>(pf)</span><br><span class="line">            <span class="built_in">print</span>(qf)</span><br><span class="line">            phi = (pf - <span class="number">1</span>) * (qf - <span class="number">1</span>)</span><br><span class="line">            d = inverse(e, phi)</span><br><span class="line">            m1 = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m1))</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> (pxorq[l] == <span class="string">&quot;1&quot;</span> <span class="keyword">and</span> pxorq[<span class="number">255</span> - l] == <span class="string">&quot;1&quot;</span>):</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">        <span class="keyword">elif</span> (pxorq[l] == <span class="string">&quot;1&quot;</span> <span class="keyword">and</span> pxorq[<span class="number">255</span> - l] == <span class="string">&quot;0&quot;</span>):</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">        <span class="keyword">elif</span> (pxorq[l] == <span class="string">&quot;0&quot;</span> <span class="keyword">and</span> pxorq[<span class="number">255</span> - l] == <span class="string">&quot;1&quot;</span>):</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">        <span class="keyword">elif</span> (pxorq[l] == <span class="string">&quot;0&quot;</span> <span class="keyword">and</span> pxorq[<span class="number">255</span> - l] == <span class="string">&quot;0&quot;</span>):</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;0&quot;</span>, <span class="string">&quot;0&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;0&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;0&quot;</span> + ql)</span><br><span class="line">            find(ph + <span class="string">&quot;1&quot;</span>, qh + <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span> + pl, <span class="string">&quot;1&quot;</span> + ql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">find(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment">#p = 64760524083545528318139240449356269097871629401328435356643510319660757701117</span></span><br><span class="line"><span class="comment">#q = 109947782034870726628911928816041880655659770652764045401662566933641952899777</span></span><br><span class="line"><span class="comment">#-908f-7c002c687387</span></span><br></pre></td></tr></table></figure>
<p>ECCéƒ¨åˆ†ï¼Œå› ä¸º<code>n</code>ä¸æ˜¯è´¨æ•°ï¼Œ<code>E = EllipticCurve(Zmod(n),[114514,1919810])</code>æ— æ³•ç›´æ¥ç®—<code>E.order</code></p>
<blockquote>
<p>ç¬¬äºŒéƒ¨åˆ†æ˜¯ECCï¼Œæ›²çº¿åœ¨æ¨¡nä¸Šçš„é˜¶ä¸å¥½ç›´æ¥ç®—ï¼Œè€Œ<code>n = pq</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ†åˆ«æ„å»ºåœ¨æ¨¡på’Œæ¨¡qä¸Šçš„æ›²çº¿ï¼Œç„¶ååˆ†åˆ«è®¡ç®—å…¶é˜¶ï¼Œè¿›è€Œå¾—åˆ°æ›²çº¿åœ¨æ¨¡nä¸Šçš„é˜¶ï¼Œæ¥ä¸‹æ¥å°±è®¡ç®—å‡ºeå¯¹äºæ›²çº¿çš„é€†å…ƒæ±‚å‡ºç‚¹Gï¼Œå…¶æ¨ªåæ ‡å³ä¸ºflagéƒ¨åˆ†</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">64760524083545528318139240449356269097871629401328435356643510319660757701117</span></span><br><span class="line">q = <span class="number">109947782034870726628911928816041880655659770652764045401662566933641952899777</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">7120275986401660066259983193598830554385933355254283093021239164350142898387660104515624591378875067038235085428170557400012848874756868985306042421950909</span></span><br><span class="line">E = EllipticCurve(Zmod(n),[<span class="number">114514</span>,<span class="number">1919810</span>])</span><br><span class="line">Eq = EllipticCurve(Zmod(p),[<span class="number">114514</span>,<span class="number">1919810</span>])</span><br><span class="line">Ep = EllipticCurve(Zmod(q),[<span class="number">114514</span>,<span class="number">1919810</span>])</span><br><span class="line">P = E(<span class="number">4143131125485719352848137000299706175276016714942734255688381872061184989156686585992844083387698688432978380177564346382756951426943827434190895490233627</span>,<span class="number">3879946878859691332371384275396678851932267609535096278038417524609690721322205780110680003522999409696718745532857001461869452116434787256032366267905519</span>)</span><br><span class="line"></span><br><span class="line">phi = Ep.order()*Eq.order()</span><br><span class="line">d = inverse_mod(e,phi)</span><br><span class="line">G = P*d</span><br><span class="line">x = G.xy()[<span class="number">0</span>]</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(x))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#a67b2a9b-0542-4646</span></span><br></pre></td></tr></table></figure>
<h2 id="week3-approximate_n"><a class="markdownIt-Anchor" href="#week3-approximate_n"></a> [Week3] Approximate_n</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">gen_AGCD</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.p = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enc_</span>(<span class="params">self,M,e</span>):</span><br><span class="line">        C = <span class="built_in">pow</span>(M,e,self.p*self.q)</span><br><span class="line">        <span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">re_n</span>(<span class="params">self</span>):</span><br><span class="line">        n = self.p * self.q</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">re_approximate_n</span>(<span class="params">self</span>):</span><br><span class="line">        k = getPrime(<span class="number">512</span>)</span><br><span class="line">        r = getPrime(<span class="number">247</span>)</span><br><span class="line">        n_approx = k*self.p + r</span><br><span class="line">        <span class="keyword">return</span> n_approx</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    m1 = flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]</span><br><span class="line">    m2 = flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:]</span><br><span class="line">    Encrypt1,Encrypt2 = gen_AGCD(),gen_AGCD()</span><br><span class="line">    C1,C2 = Encrypt1.enc_(bytes_to_long(m1),e),Encrypt2.enc_(bytes_to_long(m2),e)</span><br><span class="line">    N1,N2 = Encrypt1.re_n(),Encrypt2.re_n()</span><br><span class="line"></span><br><span class="line">    N1_reveal = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        N1_reveal.append(Encrypt1.re_approximate_n())</span><br><span class="line"></span><br><span class="line">    N2_reveal = Encrypt2.re_approximate_n()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;N1 = &#x27;</span>,N1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;N1_reveal = &#x27;</span>,N1_reveal)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;N2 = &#x27;</span>,N2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;N2_reveal = &#x27;</span>,N2_reveal)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;C1 = &#x27;</span>,C1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;C2 = &#x27;</span>,C2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N1 =  <span class="number">102962552313473681728723322027597495151261114315051654555740869168148851188107854721536927044442477024748737428557517373823588689936901897797548745673854079501679297287539034025897513808964218875037065595406090476664786378152185622507380646052951461871717529116320541684644754051755754531805285234195783459797</span></span><br><span class="line">N1_reveal =  [<span class="number">84964829388932061103921957564400125835225719859859510858139343342261376376157402024398819986017063183458456828492439572516643205332521427900739404476385470419622209362062083925319479315213697191724734211420880495849938453677919942805188598151056713085050385277709604039546106740559422133098067538922509028026</span>, <span class="number">55669509569768064992718044981508136553780767046165209632722329021340164900457535356449024438332915321096786789178632805942918771290307399969035141367566285033608334974253364423607773168674448262916865622517458219728181629393946832062619043643614691875540521738073083356495356354589975146111840434325826819198</span>, <span class="number">77685152020329500125709975458280809065472024091250688730112377730513223488123677602004197722852227049782404484028558802978507114097790917123660341486556373425727358230049052549163794395853900552906583518153257035524675564804300429030789204176869525785233188403701602735082197253517936111533915552254489942100</span>]</span><br><span class="line">N2 =  <span class="number">145695734665913924175257010903736847918479731583810112670586295711507006721687964045835283940602289356463440889254858811892174016632853579082476117049110447325282176943898704794699667611214913712864592929971488447744298834755679410556926588941532837174941263569541567155147274901631570672266026762222017289227</span></span><br><span class="line">N2_reveal =  <span class="number">106591311015041707504427951524895388920764384711385757797259452186432986318069454764620553244440558018454822708698461947331019517972650964856645609803899846038300130117604888308467416926253698141673017770502681168291198497788777522823584345758599336082924744440309241874946430102035624053576103790460393511000</span></span><br><span class="line">C1 =  <span class="number">31594760924666716787696903268342555231641698238925332007707704877423492362096435897073322741916758988157019741830738840842789410609168701142508513641113736572436428873604154027131784982853515763286590388817560388868474399310388515155495051085286726425733319515674947391576533055200594330161967599295787080238</span></span><br><span class="line">C2 =  <span class="number">4381442301959411454419528795285171587562699421595269409042378524455996065490866727436284838704991923851683436641171227423822439331431086471420344514064543535743315441111296570325222557430574781227184974662494500152603806343531164187542532001697617016254670457335540803929721604735961633537756194281168094293</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>AGCDé—®é¢˜(<em>The Approximate Common Divisor Problem</em>, è¿‘ä¼¼æœ€å¤§å…¬çº¦æ•°é—®é¢˜)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"> </span><br><span class="line"><span class="comment">################################################ gen data</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">140467306170270103085247508412489910487748378129459335724515767186097064975754544045630037530915800592540391724032146546032522637400331469533944394808073412880910356816384584939641130518688696505047701134385883270706411370356446043518762317844784816655044013536852156232391544081389664919694551145695399468209</span></span><br><span class="line">m = <span class="number">1</span></span><br><span class="line">rho = <span class="number">243</span></span><br><span class="line">a = [<span class="string">&quot;pad&quot;</span>] + [<span class="number">112361172352758758900704170210296813010289510849392179799708472107731966956610675285107363588332515564687781269380345968222030537131341680443039011164210540824825702663120697518389091670478368564009900422608869461335061183241377132579449529050747663021748003410091799048984189262111414502180481142308877537330</span>]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">ii</span>):</span><br><span class="line">    a = [<span class="string">&quot;pad&quot;</span>] + [<span class="number">112361172352758758900704170210296813010289510849392179799708472107731966956610675285107363588332515564687781269380345968222030537131341680443039011164210540824825702663120697518389091670478368564009900422608869461335061183241377132579449529050747663021748003410091799048984189262111414502180481142308877537330</span> - <span class="number">2</span>^<span class="number">243</span>*ii]</span><br><span class="line"> </span><br><span class="line">    <span class="comment">################################################ params</span></span><br><span class="line">    t,k = <span class="number">20</span>,<span class="number">10</span></span><br><span class="line">    R = <span class="number">2</span>^rho</span><br><span class="line">    indices = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>)] , repeat=m):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sum</span>(<span class="built_in">list</span>(i)) &lt;= t):</span><br><span class="line">            indices.append([<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(i))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">################################################ attack</span></span><br><span class="line">    PR = ZZ[<span class="built_in">tuple</span>(<span class="string">f&quot;X<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m))]</span><br><span class="line">    X = [<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(PR.gens())</span><br><span class="line">    poly = []</span><br><span class="line">    monomials=<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> indices:</span><br><span class="line">        f = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> ij <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(i)):</span><br><span class="line">            f *= (X[ij] - a[ij])^i[ij]</span><br><span class="line">        l = <span class="built_in">max</span>(k-<span class="built_in">sum</span>(i[<span class="number">1</span>:]),<span class="number">0</span>)</span><br><span class="line">        f *= N^l</span><br><span class="line">        poly.append(f)</span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> f.monomials():</span><br><span class="line">            monomials.add(mono)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">################################################# LLL and resultant to find roots</span></span><br><span class="line">    L = Matrix(ZZ,<span class="built_in">len</span>(poly),<span class="built_in">len</span>(monomials))</span><br><span class="line">    monomials = <span class="built_in">sorted</span>(monomials)</span><br><span class="line">    <span class="keyword">for</span> row,shift <span class="keyword">in</span> <span class="built_in">enumerate</span>(poly):</span><br><span class="line">        <span class="keyword">for</span> col,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">            L[row,col] = shift.monomial_coefficient(monomial)*monomial(*([R]*m))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    res = L.LLL()</span><br><span class="line">    vec1 = res[<span class="number">0</span>]</span><br><span class="line"> </span><br><span class="line">    h = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">        h += (vec1[idx] // monomial(*([R]*m))) * monomial</span><br><span class="line">    h = h.change_ring(ZZ)</span><br><span class="line">    res1 = h.monic().roots()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(res1 != []):</span><br><span class="line">        <span class="built_in">print</span>(ii,res1)</span><br><span class="line"> </span><br><span class="line">lists = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">4</span>)]</span><br><span class="line"><span class="keyword">with</span> Pool(<span class="number">64</span>) <span class="keyword">as</span> pool:</span><br><span class="line">    r = <span class="built_in">list</span>(pool.imap(attack, lists[::-<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">N1 =  <span class="number">95220181639626796948143489111363011090242644821307671338154270835002234872743806643238045743730383147579107484367700436409496448813817802882720705692308647479031357497697641512864558224737946906678321719550292939790297201774030189554354483674392204774757404512862366152441023131093295296126511526758311787533</span></span><br><span class="line">N1_reveal =  [<span class="number">135155723555580971102472760772113547068449856046446854944834185144725761315605950196417754719294327893501350155917123418471539586751734839913060001278469803495357936187202804035231480363027024883649894394029336416980140164261450806845325519324810810467082188549167892975300709885928089524964332523979084819616</span>, <span class="number">108225506327736990488056174532377782531488789170481659195448002422578807037623697635657548142074567159473902317405281775338219092114459739427575748704020302366750567205951022768559028784623405841592241560555854170026194465021522071306555697601208669120660672533978751002577604163682049989736857050431577335988</span>, <span class="number">97902238601080686791205456188991250567366116257787701998068858649901314188048320624369804248648395722811017072099995983115879965009017127675781815863771820270952769969131391080759752609678760644627826776136946615977348372397823851983199152097271925548232778437840248637945701889965062651061992125582772864886</span>]</span><br><span class="line">N2 =  <span class="number">140467306170270103085247508412489910487748378129459335724515767186097064975754544045630037530915800592540391724032146546032522637400331469533944394808073412880910356816384584939641130518688696505047701134385883270706411370356446043518762317844784816655044013536852156232391544081389664919694551145695399468209</span></span><br><span class="line">N2_reveal =  <span class="number">112361172352758758900704170210296813010289510849392179799708472107731966956610675285107363588332515564687781269380345968222030537131341680443039011164210540824825702663120697518389091670478368564009900422608869461335061183241377132579449529050747663021748003410091799048984189262111414502180481142308877537330</span></span><br><span class="line">C1 =  <span class="number">31950452009658012741321403366243455956978705529042164534321777183203324554858632439237234885410149568398983557280801461287159709181598872210801564966331769742332023309821039892558563273355301616744286335388072082262778934580513252668404512993042262043925583364437774382631570617154342054943064279866085770928</span></span><br><span class="line">C2 =  <span class="number">28043955361950149290736307328827214922496448239701009207491436374533557770205348310700271429655733973145555148184288870618672293135244638728814923159375304575547925591181048341809750424936159673404585158750785837663773658200516125280634048184681727065354159475141953332267189169344585136326725855832157455620</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#https://eprint.iacr.org/2016/215.pdf</span></span><br><span class="line">K=<span class="number">2</span>^<span class="number">249</span></span><br><span class="line">L=Matrix(ZZ,[[K,N1_reveal[<span class="number">1</span>],N1_reveal[<span class="number">2</span>]],</span><br><span class="line">             [<span class="number">0</span>,-N1_reveal[<span class="number">0</span>],<span class="number">0</span>],</span><br><span class="line">             [<span class="number">0</span>,<span class="number">0</span>,-N1_reveal[<span class="number">0</span>]]])</span><br><span class="line">L=L.LLL()</span><br><span class="line"> </span><br><span class="line">p1=<span class="built_in">int</span>(N1_reveal[<span class="number">0</span>]//(<span class="built_in">abs</span>(L[<span class="number">0</span>][<span class="number">0</span>])//K))</span><br><span class="line">q1=N1//p1</span><br><span class="line">flag1=long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(C1,inverse_mod(<span class="number">65537</span>,(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)),N1)))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># https://tangcuxiaojikuai.xyz/post/4a67318c.html ç¬¬ä¸€éƒ¨åˆ† 1.12 12</span></span><br><span class="line"><span class="comment">#15 [(-271336741980068587844448337263932213024816515815388263122784492996415507, 1)]</span></span><br><span class="line"><span class="comment">#14 [(13863439776247006048821931668679415913595054659189563401850065117344542701, 1)]</span></span><br><span class="line">r=<span class="number">13863439776247006048821931668679415913595054659189563401850065117344542701</span></span><br><span class="line"><span class="comment"># print(int(r).bit_length())  #243</span></span><br><span class="line">r=r+<span class="number">2</span>^<span class="number">243</span>*<span class="number">14</span></span><br><span class="line">p2=GCD(N2,N2_reveal-r)</span><br><span class="line">flag2=long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(C2,inverse_mod(<span class="number">65537</span>,p2-<span class="number">1</span>),p2)))</span><br><span class="line"><span class="built_in">print</span>(flag1+flag2)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#b&#x27;SHCTF&#123;APPROxiMaTE_n_H4PpY_7hE_NEW_GGag_2_Da&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="week3-babylcg"><a class="markdownIt-Anchor" href="#week3-babylcg"></a> [Week3] babyLCG</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">seed = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">a = getPrime(<span class="number">400</span>)</span><br><span class="line">b = getPrime(<span class="number">400</span>)</span><br><span class="line">p = getPrime(<span class="number">400</span>)</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    seed = (seed*a+b)%p</span><br><span class="line">    c.append(seed&gt;&gt;<span class="number">80</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a = 2475888996632094582034122163505958703059936413843532352796751833709426858969562425221138286394228921214141232352754363633</span></span><br><span class="line"><span class="string">b = 1905480696303984902796083235070180899781860050180854546296493122498519159940315402346589283466547617432046217796603160773</span></span><br><span class="line"><span class="string">p = 2209046612698920104484284797114056179410109590589945885514075526562344194607111614640088528695744803046785464320831674877</span></span><br><span class="line"><span class="string">c = [3046229294982134450591178033489768650552322716872597427107928034748567068803980276957057890481, 973001372006880118889917783354942758117321515064139462745181212051769645104406522505813126876854, 890186362163854321562009885401997664814267684052369722289787654117599676602992999049017980432156]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>å¤ä¹ ä¸€ä¸‹LCGï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dexterjie.github.io/2024/07/16/%E6%B5%81%E5%AF%86%E7%A0%81/%E6%B5%81%E5%AF%86%E7%A0%81-LCG/">LCG | DexterJieâ€™Blog</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/XiongSiqi_blog/article/details/130790621">è®° LCG ä¾‹é¢˜_-CSDNåšå®¢</a></li>
</ul>
<p><code>seed&gt;&gt;80</code>æœ‰ä½ç§»ï¼Œåº”è¯¥è¦ç”¨æ ¼</p>
<p>ç¬¬ä¸€ç§ï¼šæ‰‹åŠ¨æ„é€ æ ¼ <a target="_blank" rel="noopener" href="https://www.cnblogs.com/naby/p/18494522">SHCTF2024-week3-Crypto - Naby - åšå®¢å›­</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">a = <span class="number">2441165060340363548034817419913152429437367671051257983130193376968866003652656064753193540692576823353722522219951236377</span></span><br><span class="line">b = <span class="number">2536384599388118977308934726385759683875116193910292140931807458602198040481977699550435249496535909362102559820360131151</span></span><br><span class="line">p = <span class="number">1898350626517014951217210423867648293636462375574846448952061608918022029275967066566474923728317050045578381447025802447</span></span><br><span class="line">c = [<span class="number">1206170611286987749822509820930522025955557233442828617888124729629984583540215838639710785581993</span>, <span class="number">852222709497386792919622853438477061105763652894458161025475550177341850861286444913870176145661</span>, <span class="number">1304945544687728464084706289648969970911515894526834307083141183941320491375891396365871606911311</span>]</span><br><span class="line"> </span><br><span class="line">h = [<span class="number">0</span>] + c</span><br><span class="line"> </span><br><span class="line">length = <span class="built_in">len</span>(h)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    h[i] &lt;&lt;= <span class="number">80</span></span><br><span class="line"> </span><br><span class="line">A = [<span class="number">1</span>]</span><br><span class="line">B = [<span class="number">0</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(h)-<span class="number">1</span>):</span><br><span class="line">	A.append(a*A[i-<span class="number">1</span>] % p)</span><br><span class="line">	B.append((a*B[i-<span class="number">1</span>]+a*h[i]+b-h[i+<span class="number">1</span>]) % p)</span><br><span class="line"> </span><br><span class="line">A = A[<span class="number">1</span>:]</span><br><span class="line">B = B[<span class="number">1</span>:]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">Ge = Matrix(ZZ,length,length)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">    Ge[i,i] = p</span><br><span class="line">    Ge[-<span class="number">2</span>,i] = A[i]</span><br><span class="line">    Ge[-<span class="number">1</span>,i] = B[i]</span><br><span class="line"> </span><br><span class="line">K = <span class="number">2</span>**<span class="number">80</span></span><br><span class="line">Ge[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">Ge[-<span class="number">1</span>,-<span class="number">1</span>] = K</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> Ge.LLL():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(line[-<span class="number">1</span>]) == K:</span><br><span class="line">        L1 = line[-<span class="number">2</span>]</span><br><span class="line">        seed1 = h[<span class="number">1</span>] + L1</span><br><span class="line">        seed = (seed1 - b) * inverse_mod(a,p) % p</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;seed = <span class="subst">&#123;seed&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(seed))</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§ï¼šä¸ŠäºŒå…ƒcoppersmith <a target="_blank" rel="noopener" href="https://blog.csdn.net/XiongSiqi_blog/article/details/130790621#t9">è®° LCG ä¾‹é¢˜-CSDNåšå®¢</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">        base = N^(m-i) * f^i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span>/factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">output =  [<span class="number">3046229294982134450591178033489768650552322716872597427107928034748567068803980276957057890481</span>, <span class="number">973001372006880118889917783354942758117321515064139462745181212051769645104406522505813126876854</span>, <span class="number">890186362163854321562009885401997664814267684052369722289787654117599676602992999049017980432156</span>]</span><br><span class="line">a = <span class="number">2475888996632094582034122163505958703059936413843532352796751833709426858969562425221138286394228921214141232352754363633</span></span><br><span class="line">b = <span class="number">1905480696303984902796083235070180899781860050180854546296493122498519159940315402346589283466547617432046217796603160773</span></span><br><span class="line">n = <span class="number">2209046612698920104484284797114056179410109590589945885514075526562344194607111614640088528695744803046785464320831674877</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = ((output[<span class="number">0</span>]&lt;&lt;<span class="number">80</span>)+ x) * a + b - ((output[<span class="number">1</span>]&lt;&lt;<span class="number">80</span>) + y)</span><br><span class="line">roots = small_roots(f,(<span class="number">2</span>^<span class="number">80</span>, <span class="number">2</span>^<span class="number">80</span>), m=<span class="number">4</span>, d=<span class="number">4</span>)</span><br><span class="line">s1 = (output[<span class="number">0</span>]&lt;&lt;<span class="number">80</span>) + roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">m = (s1 - b) * inverse_mod(a, n) % n</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure>
<h2 id="week3-shamir"><a class="markdownIt-Anchor" href="#week3-shamir"></a> [Week3] Shamir</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getenv</span><br><span class="line"></span><br><span class="line">BANNER = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"> __          __  _                            _______       _____ _                     _      </span></span><br><span class="line"><span class="string"> \ \        / / | |                          |__   __|     / ____| |                   (_)     </span></span><br><span class="line"><span class="string">  \ \  /\  / /__| | ___ ___  _ __ ___   ___     | | ___   | (___ | |__   __ _ _ __ ___  _ _ __ </span></span><br><span class="line"><span class="string">   \ \/  \/ / _ \ |/ __/ _ \| &#x27;_ ` _ \ / _ \    | |/ _ \   \___ \| &#x27;_ \ / _` | &#x27;_ ` _ \| | &#x27;__|</span></span><br><span class="line"><span class="string">    \  /\  /  __/ | (_| (_) | | | | | |  __/    | | (_) |  ____) | | | | (_| | | | | | | | |   </span></span><br><span class="line"><span class="string">     \/  \/ \___|_|\___\___/|_| |_| |_|\___|    |_|\___/  |_____/|_| |_|\__,_|_| |_| |_|_|_|   </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(BANNER)</span><br><span class="line"></span><br><span class="line">flag = getenv(<span class="string">&quot;GZCTF_FLAG&quot;</span>,<span class="string">&quot;GZCTF_NOT_DEFINE&quot;</span>)</span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">n = getPrime(<span class="number">1024</span>)</span><br><span class="line">coefficients = [m] + [random.randrange(<span class="number">1</span>,n-<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(coefficients)):</span><br><span class="line">        <span class="built_in">sum</span> += coefficients[i]*<span class="built_in">pow</span>(x,i,n) % n</span><br><span class="line">        <span class="built_in">sum</span> %= n</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Please Input x: &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Not Allowed!!!&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    res = (x,f(x))</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>
<p>Shamiré—¨é™ï¼Œå¤šé¡¹å¼æœ€å¤§ç³»æ•°ä¸º100ï¼Œé€šè¿‡äº¤äº’å¾—åˆ°101ä¸ªç‚¹çš„åæ ‡ï¼Œåˆ©ç”¨æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•å¾—åˆ°è¿™100ä¸ªç³»æ•°çš„å€¼</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">r=remote(<span class="string">&quot;210.44.150.15&quot;</span>,<span class="number">40430</span>)</span><br><span class="line"> </span><br><span class="line">r.recvuntil(<span class="string">b&#x27;n = &#x27;</span>)</span><br><span class="line">n=<span class="built_in">eval</span>(r.recvline().strip().decode())</span><br><span class="line"> </span><br><span class="line">m=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">101</span>+<span class="number">1</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;Please Input x: &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(i).encode())</span><br><span class="line"> </span><br><span class="line">    tmp=<span class="built_in">eval</span>(r.recvline().strip())</span><br><span class="line">    m.append(tmp)</span><br><span class="line">    </span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">    tmp1=<span class="number">1</span></span><br><span class="line">    tmp2=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">        <span class="keyword">if</span> i==j:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        tmp1*=-m[j][<span class="number">0</span>]</span><br><span class="line">        tmp2*=(m[i][<span class="number">0</span>]-m[j][<span class="number">0</span>])</span><br><span class="line">    flag=(flag+m[i][<span class="number">1</span>]*tmp1*inverse(tmp2,n))%n</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://dawn1ight.github.io">dawn1ight</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://dawn1ight.github.io/post/23197/">https://dawn1ight.github.io/post/23197/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://dawn1ight.github.io" target="_blank">dawn1ight çš„å°å±‹</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WriteUp/">WriteUp</a></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/44080/" title="0xGame2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/10/06/aTHDgoRr5tzmFy7.jpg" onerror="onerror=null;src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">0xGame2024 Crypto WriteUp</div></div></a></div><div class="next-post pull-right"><a href="/post/11600/" title="PatriotCTF 2024 Crypto Writeup"><img class="cover" src="https://s2.loli.net/2024/09/29/CI25B8oKeFMb1Hh.jpg" onerror="onerror=null;src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">PatriotCTF 2024 Crypto Writeup</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/post/11600/" title="PatriotCTF 2024 Crypto Writeup"><img class="cover" src="https://s2.loli.net/2024/09/29/CI25B8oKeFMb1Hh.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-29</div><div class="title">PatriotCTF 2024 Crypto Writeup</div></div></a></div><div><a href="/post/44080/" title="0xGame2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/10/06/aTHDgoRr5tzmFy7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-06</div><div class="title">0xGame2024 Crypto WriteUp</div></div></a></div><div><a href="/post/30110/" title="SCTF 2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/09/30/DgVuBbdJZW8ynmE.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-29</div><div class="title">SCTF 2024 Crypto WriteUp</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2024/06/09/8Hyr97a4VnGmL5K.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/wNr574gd2t1MYzh.gif'" alt="avatar"/></div><div class="author-info__name">dawn1ight</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dawn1ight"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dawn1ight" target="_blank" title="Github"><i class="fab fa-github" style="color: #346c9c;"></i></a><a class="social-icon" href="mailto:dawn1ight@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #346c9c;"></i></a><a class="social-icon" href="https://f1eeg0urj5.feishu.cn/docx/doxcnpFk1I5yfY8A5CmsjJsAeOb" target="_blank" title="Feishu"><i class="fa fa-book-open" style="color: #346c9c;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ° dawn1ight çš„å°å±‹</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#shctf2024-writeup"><span class="toc-number">1.</span> <span class="toc-text"> SHCTF2024 WriteUp</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-baby_mod"><span class="toc-number">1.1.</span> <span class="toc-text"> [Week1] baby_mod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-d_known"><span class="toc-number">1.2.</span> <span class="toc-text"> [Week1] d_known</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2-worde%E5%BE%88%E5%A4%A7"><span class="toc-number">1.3.</span> <span class="toc-text"> [Week2] wordeå¾ˆå¤§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2-pading"><span class="toc-number">1.4.</span> <span class="toc-text"> [Week2] pading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2-er"><span class="toc-number">1.5.</span> <span class="toc-text"> [Week2] E&amp;R</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3-approximate_n"><span class="toc-number">1.6.</span> <span class="toc-text"> [Week3] Approximate_n</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3-babylcg"><span class="toc-number">1.7.</span> <span class="toc-text"> [Week3] babyLCG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3-shamir"><span class="toc-number">1.8.</span> <span class="toc-text"> [Week3] Shamir</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/44080/" title="0xGame2024 Crypto WriteUp"><img src="https://s2.loli.net/2024/10/06/aTHDgoRr5tzmFy7.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="0xGame2024 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/44080/" title="0xGame2024 Crypto WriteUp">0xGame2024 Crypto WriteUp</a><time datetime="2024-10-05T16:00:00.000Z" title="å‘è¡¨äº 2024-10-06 00:00:00">2024-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/23197/" title="SHCTF2024 WriteUp"><img src="https://s2.loli.net/2024/10/05/fvB8o4VdOgXwIcU.png" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="SHCTF2024 WriteUp"/></a><div class="content"><a class="title" href="/post/23197/" title="SHCTF2024 WriteUp">SHCTF2024 WriteUp</a><time datetime="2024-10-04T16:00:00.000Z" title="å‘è¡¨äº 2024-10-05 00:00:00">2024-10-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/11600/" title="PatriotCTF 2024 Crypto Writeup"><img src="https://s2.loli.net/2024/09/29/CI25B8oKeFMb1Hh.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="PatriotCTF 2024 Crypto Writeup"/></a><div class="content"><a class="title" href="/post/11600/" title="PatriotCTF 2024 Crypto Writeup">PatriotCTF 2024 Crypto Writeup</a><time datetime="2024-09-28T16:00:00.000Z" title="å‘è¡¨äº 2024-09-29 00:00:00">2024-09-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/30110/" title="SCTF 2024 Crypto WriteUp"><img src="https://s2.loli.net/2024/09/30/DgVuBbdJZW8ynmE.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="SCTF 2024 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/30110/" title="SCTF 2024 Crypto WriteUp">SCTF 2024 Crypto WriteUp</a><time datetime="2024-09-28T16:00:00.000Z" title="å‘è¡¨äº 2024-09-29 00:00:00">2024-09-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/1/" title="ä¿¡æ¯è®ºä¸ç¼–ç è¯¾ç¨‹å®éªŒ"><img src="https://s2.loli.net/2024/06/28/6s4oFTOxhcUe5fn.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="ä¿¡æ¯è®ºä¸ç¼–ç è¯¾ç¨‹å®éªŒ"/></a><div class="content"><a class="title" href="/post/1/" title="ä¿¡æ¯è®ºä¸ç¼–ç è¯¾ç¨‹å®éªŒ">ä¿¡æ¯è®ºä¸ç¼–ç è¯¾ç¨‹å®éªŒ</a><time datetime="2024-06-19T16:00:00.000Z" title="å‘è¡¨äº 2024-06-20 00:00:00">2024-06-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2024/06/09/l9xkjgDWpeo4mRE.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By dawn1ight</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">å¾ªæ¢¦è€Œè¡Œï¼Œå‘é˜³è€Œç”Ÿã€‚</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç®€</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="/true"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: 'Ov23liRPPsC1oftZQM2P',
      clientSecret: 'b9eeefe537ddfa8e7911b1414ce68310afbdc4cf',
      repo: 'dawn1ight.github.io.gitalk',
      owner: 'dawn1ight',
      admin: ['dawn1ight'],
      id: 'c6c267d168730e8c4af798a049853081',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const findTrueUrl = (array) => {
    Promise.all(array.map(item =>
      fetch(item.url).then(resp => resp.json()).then(data => {
        let urlArray = data.body ? data.body.match(/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?/ig) : []
        if (!Array.isArray(urlArray) || urlArray.length === 0) {
          urlArray = [`${data.html_url}`]
        }
        if (data.user.login === 'utterances-bot') {
          return urlArray.pop()
        } else {
          return urlArray.shift()
        }
      })
    )).then(res => {
        array = array.map((i,index)=> {
          return {
            ...i,
            url: res[index]
          }
        })

        saveToLocal.set('github-newest-comments', JSON.stringify(array), 10/(60*24))
        generateHtml(array)
    });
  }

  const getComment = () => {
    fetch('https://api.github.com/repos/dawn1ight/dawn1ight.github.io.gitalk/issues/comments?sort=updated&direction=desc&per_page=6&page=1',{
      "headers": {
        Accept: 'application/vnd.github.v3.html+json'
      }
    })
      .then(response => response.json())
      .then(data => {
        const githubArray = data.map(item => {
          return {
            'avatar': item.user.avatar_url,
            'content': changeContent(item.body_html || item.body),
            'nick': item.user.login,
            'url': item.issue_url,
            'date': item.updated_at,
            'githubUrl': item.html_url
          }
        })
        findTrueUrl(githubArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('github-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>