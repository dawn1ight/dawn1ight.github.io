<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>PatriotCTF 2024 Crypto Writeup | dawn1ight 的孤岛</title><meta name="author" content="dawn1ight"><meta name="copyright" content="dawn1ight"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="PatriotCTF 2024 Crypto Writeup Author: dawn1ight About: PatriotCTF is a beginner-friendly capture-the-flag competition hosted by GMU’s cybersecurity club, MasonCC. All are welcome to participate, inc">
<meta property="og:type" content="article">
<meta property="og:title" content="PatriotCTF 2024 Crypto Writeup">
<meta property="og:url" content="https://dawn1ight.github.io/post/11600/index.html">
<meta property="og:site_name" content="dawn1ight 的孤岛">
<meta property="og:description" content="PatriotCTF 2024 Crypto Writeup Author: dawn1ight About: PatriotCTF is a beginner-friendly capture-the-flag competition hosted by GMU’s cybersecurity club, MasonCC. All are welcome to participate, inc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/09/29/CI25B8oKeFMb1Hh.jpg">
<meta property="article:published_time" content="2024-09-28T16:00:00.000Z">
<meta property="article:modified_time" content="2024-12-30T07:21:35.921Z">
<meta property="article:author" content="dawn1ight">
<meta property="article:tag" content="WriteUP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/09/29/CI25B8oKeFMb1Hh.jpg"><link rel="shortcut icon" href="https://s2.loli.net/2024/06/09/efzNlYosV9I7DTd.jpg"><link rel="canonical" href="https://dawn1ight.github.io/post/11600/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?[object Object]";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PatriotCTF 2024 Crypto Writeup',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-30 15:21:35'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/loading.css"><link rel="stylesheet" href="/css/progress_bar.css"><link rel="stylesheet" href="/css/scrollbar.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="dawn1ight 的孤岛" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2024/06/09/8Hyr97a4VnGmL5K.jpg" onerror="onerror=null;src='https://s2.loli.net/2024/06/09/wNr574gd2t1MYzh.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博客</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/share/"><i class="fa-fw fa fa-share-alt"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书架</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2024/06/09/l9xkjgDWpeo4mRE.png')"><nav id="nav"><span id="blog-info"><a href="/" title="dawn1ight 的孤岛"><img class="site-icon" src="https://s2.loli.net/2024/06/09/efzNlYosV9I7DTd.jpg"/><span class="site-name">dawn1ight 的孤岛</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博客</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/share/"><i class="fa-fw fa fa-share-alt"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书架</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">PatriotCTF 2024 Crypto Writeup</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-28T16:00:00.000Z" title="发表于 2024-09-29 00:00:00">2024-09-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-30T07:21:35.921Z" title="更新于 2024-12-30 15:21:35">2024-12-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Crypto/">Crypto</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="PatriotCTF 2024 Crypto Writeup"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="patriotctf-2024-crypto-writeup"><a class="markdownIt-Anchor" href="#patriotctf-2024-crypto-writeup"></a> PatriotCTF 2024 Crypto Writeup</h1>
<p>Author: <em>dawn1ight</em></p>
<p>About: PatriotCTF is a beginner-friendly capture-the-flag competition hosted by GMU’s cybersecurity club, MasonCC. All are welcome to participate, including students and security professionals. Challenges will range from beginner to expert, so there should be something for everyone. This is a jeopardy-style CTF, meaning there will be various challenges from the different categories described below.</p>
<p>Challenges：<a target="_blank" rel="noopener" href="https://pctf.competitivecyber.club/challenges">https://pctf.competitivecyber.club/challenges</a></p>
<p>References:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52640415/article/details/142500402">https://blog.csdn.net/weixin_52640415/article/details/142500402</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ctfiot.com/206569.html">https://www.ctfiot.com/206569.html</a></li>
<li><a target="_blank" rel="noopener" href="https://s19ma.github.io/posts/PatriotCTF/">https://s19ma.github.io/posts/PatriotCTF/</a></li>
</ul>
<hr />
<h2 id="bigger-is-better"><a class="markdownIt-Anchor" href="#bigger-is-better"></a> Bigger is Better</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">N = <span class="number">0xa0d9f425fe1246c25b8c3708b9f6d7747dd5b5e7f79719831c5cbe19fb7bab66ed62719b3fc6090120d2cfe1410583190cd650c32a4151550732b0fc97130e5f02aa26cb829600b6ab452b5b11373ec69d4eaae6c392d92da8bcbea85344af9d4699e36fdca075d33f58049fd0a9f6919f3003512a261a00985dc3d9843a822974df30b81732a91ce706c44bde5ff48491a45a5fa8d5d73bba5022af803ab7bd85250e71fc0254fcf078d21eaa5d38724014a85f679e8a7a1aad6ed22602465f90e6dd8ef95df287628832850af7e3628ad09ff90a6dbdf7a0e6d74f508d2a6235d4eae5a828ac95558bbdf72f39af5641dfe3edb0cdaab362805d926106e2af</span></span><br><span class="line">e = <span class="number">0x5af5dbe4af4005564908a094e0eabb0a921b7482483a753e2a4d560700cb2b2dc9399b608334e05140f54d90fcbef70cec097e3f75395d0c4799d9ec3e670aca41da0892a7b3d038acb7a518be1ced8d5224354ce39e465450c12be653639a8215afb1ba70b1f8f71fc1a0549853998e2337604fca7edac67dd1e7ddeb897308ebf26ade781710e6a2fe4c533a584566ea42068d0452c1b1ecef00a781b6d31fbab893de0c9e46fce69c71cefad3119e8ceebdab25726a96aaf02a7c4a6a38d2f75f413f89064fef14fbd5762599ca8eb3737122374c5e34a7422ea1b3d7c43a110d3209e1c5e23e4eece9e964da2c447c9e5e1c8a6038dc52d699f9324fd6b9</span></span><br><span class="line">c = <span class="number">0x731ceb0ac8f10c8ff82450b61b414c4f7265ccf9f73b8e238cc7265f83c635575a9381aa625044bde7b34ad7cce901fe7512c934b7f6729584d2a77c47e8422c8c0fe2d3dd12aceda8ef904ad5896b971f8b79048e3e2f99f600bf6bac6cad32f922899c00fdc2d21fcf3d0093216bfc5829f02c08ba5e534379cc9118c347763567251c0fe57c92efe0a96c8595bac2c759837211aac914ea3b62aae096ebb8cb384c481b086e660f0c6249c9574289fe91b683609154c066de7a94eafa749c9e92d83a9d473cc88accd9d4c5754ccdbc5aa77ba9a790bc512404a81fc566df42b652a55b9b8ffb189f734d1c007b6cbdb67e14399182016843e27e6d4e5fca</span></span><br></pre></td></tr></table></figure>
<p>大加密指数e，经典wiener攻击</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> RSAwienerHacker.RSAwienerHacker <span class="keyword">import</span> hack_RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">n = <span class="number">0xa0d9f425fe1246c25b8c3708b9f6d7747dd5b5e7f79719831c5cbe19fb7bab66ed62719b3fc6090120d2cfe1410583190cd650c32a4151550732b0fc97130e5f02aa26cb829600b6ab452b5b11373ec69d4eaae6c392d92da8bcbea85344af9d4699e36fdca075d33f58049fd0a9f6919f3003512a261a00985dc3d9843a822974df30b81732a91ce706c44bde5ff48491a45a5fa8d5d73bba5022af803ab7bd85250e71fc0254fcf078d21eaa5d38724014a85f679e8a7a1aad6ed22602465f90e6dd8ef95df287628832850af7e3628ad09ff90a6dbdf7a0e6d74f508d2a6235d4eae5a828ac95558bbdf72f39af5641dfe3edb0cdaab362805d926106e2af</span></span><br><span class="line">e = <span class="number">0x5af5dbe4af4005564908a094e0eabb0a921b7482483a753e2a4d560700cb2b2dc9399b608334e05140f54d90fcbef70cec097e3f75395d0c4799d9ec3e670aca41da0892a7b3d038acb7a518be1ced8d5224354ce39e465450c12be653639a8215afb1ba70b1f8f71fc1a0549853998e2337604fca7edac67dd1e7ddeb897308ebf26ade781710e6a2fe4c533a584566ea42068d0452c1b1ecef00a781b6d31fbab893de0c9e46fce69c71cefad3119e8ceebdab25726a96aaf02a7c4a6a38d2f75f413f89064fef14fbd5762599ca8eb3737122374c5e34a7422ea1b3d7c43a110d3209e1c5e23e4eece9e964da2c447c9e5e1c8a6038dc52d699f9324fd6b9</span></span><br><span class="line">c = <span class="number">0x731ceb0ac8f10c8ff82450b61b414c4f7265ccf9f73b8e238cc7265f83c635575a9381aa625044bde7b34ad7cce901fe7512c934b7f6729584d2a77c47e8422c8c0fe2d3dd12aceda8ef904ad5896b971f8b79048e3e2f99f600bf6bac6cad32f922899c00fdc2d21fcf3d0093216bfc5829f02c08ba5e534379cc9118c347763567251c0fe57c92efe0a96c8595bac2c759837211aac914ea3b62aae096ebb8cb384c481b086e660f0c6249c9574289fe91b683609154c066de7a94eafa749c9e92d83a9d473cc88accd9d4c5754ccdbc5aa77ba9a790bc512404a81fc566df42b652a55b9b8ffb189f734d1c007b6cbdb67e14399182016843e27e6d4e5fca</span></span><br><span class="line">d = hack_RSA(e,n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<h2 id="idk-cipher"><a class="markdownIt-Anchor" href="#idk-cipher"></a> idk cipher</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">********************************************</span></span><br><span class="line"><span class="string">*                                          *</span></span><br><span class="line"><span class="string">*                                          *</span></span><br><span class="line"><span class="string">********************************************</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># WARNING: This is a secret key. Do not expose it.</span></span><br><span class="line">srt_key = <span class="string">&#x27;secretkey&#x27;</span> <span class="comment"># // <span class="doctag">TODO:</span> change the placeholder</span></span><br><span class="line">usr_input = <span class="built_in">input</span>(<span class="string">&quot;\t:&quot;</span>*<span class="number">10</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(usr_input) &lt;= <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;PT must be greater than 1&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(usr_input) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;PT can only be an even number&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> usr_input.isalnum():</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;Only alphabets and numbers supported&quot;</span>)</span><br><span class="line"><span class="comment"># WARNING: Reversing input might expose sensitive information.</span></span><br><span class="line">rsv_input = usr_input[::-<span class="number">1</span>]</span><br><span class="line">output_arr = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(usr_input) / <span class="number">2</span>)):</span><br><span class="line">    c1 = <span class="built_in">ord</span>(usr_input[i])</span><br><span class="line">    c2 = <span class="built_in">ord</span>(rsv_input[i])</span><br><span class="line">    enc_p1 = <span class="built_in">chr</span>(c1 ^ <span class="built_in">ord</span>(srt_key[i % <span class="built_in">len</span>(srt_key)]))</span><br><span class="line">    enc_p2 = <span class="built_in">chr</span>(c2 ^ <span class="built_in">ord</span>(srt_key[i % <span class="built_in">len</span>(srt_key)]))</span><br><span class="line">    output_arr.append(enc_p1)</span><br><span class="line">    output_arr.append(enc_p2)</span><br><span class="line"><span class="comment"># WARNING: Encoded text should not be decoded without proper authorization.</span></span><br><span class="line">encoded_val = <span class="string">&#x27;&#x27;</span>.join(output_arr)</span><br><span class="line">b64_enc_val = base64.b64encode(encoded_val.encode())</span><br><span class="line">R = <span class="string">&quot;R&quot;</span>*<span class="number">20</span></span><br><span class="line">E = <span class="string">&quot;E&quot;</span>*<span class="number">5</span></span><br><span class="line">EXCLAMATION = <span class="string">&quot;!&quot;</span>*<span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ULTRA SUPE<span class="subst">&#123;R&#125;</span> SECUR<span class="subst">&#123;E&#125;</span> Encoded Cipher Text<span class="subst">&#123;EXCLAMATION&#125;</span>:&quot;</span>, b64_enc_val.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>字符串加密，对加密脚本逆向可得解密脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">srt_key = <span class="string">&#x27;secretkey&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设这是从上面的加密脚本中得到的Base64编码的字符串</span></span><br><span class="line">b64_enc_val = <span class="string">&quot;QRVWUFdWEUpdXEVGCF8DVEoYEEIBBlEAE0dQAURFD1I=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解码Base64字符串</span></span><br><span class="line">encoded_val = base64.b64decode(b64_enc_val).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密过程</span></span><br><span class="line">decoded_arr1 = []</span><br><span class="line">decoded_arr2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encoded_val), <span class="number">2</span>):</span><br><span class="line">    c1 = <span class="built_in">ord</span>(encoded_val[i])</span><br><span class="line">    c2 = <span class="built_in">ord</span>(encoded_val[i + <span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用相同的密钥对字符进行异或操作</span></span><br><span class="line">    dec_p1 = <span class="built_in">chr</span>(c1 ^ <span class="built_in">ord</span>(srt_key[i // <span class="number">2</span> % <span class="built_in">len</span>(srt_key)]))</span><br><span class="line">    dec_p2 = <span class="built_in">chr</span>(c2 ^ <span class="built_in">ord</span>(srt_key[i // <span class="number">2</span> % <span class="built_in">len</span>(srt_key)]))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加解密后的字符到数组中</span></span><br><span class="line">    decoded_arr1.append(dec_p1)</span><br><span class="line">    decoded_arr2.append(dec_p2)</span><br><span class="line"></span><br><span class="line">first_half = decoded_arr1</span><br><span class="line">second_half = decoded_arr2[::-<span class="number">1</span>]  <span class="comment"># 反转第二部分</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并两部分得到最终解密结果</span></span><br><span class="line">usr_input = <span class="string">&#x27;&#x27;</span>.join(first_half + second_half)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted Input:&quot;</span>, usr_input)</span><br></pre></td></tr></table></figure>
<h2 id="high-roller"><a class="markdownIt-Anchor" href="#high-roller"></a> High Roller</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python3.10</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">random.seed(<span class="built_in">int</span>(time.time()))</span><br><span class="line">p, q = getPrime(<span class="number">512</span>, random.randbytes), getPrime(<span class="number">512</span>, random.randbytes)</span><br><span class="line">n = p*q</span><br><span class="line">e = getPrime(<span class="number">512</span>)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> GCD(e, phi) == <span class="number">1</span></span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line"></span><br><span class="line">key = RSA.construct((n, e, d, p, q))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;public_key.pem&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(key.publickey().export_key(<span class="string">&quot;PEM&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;private_key.pem&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(key.export_key(<span class="string">&quot;PEM&quot;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIHdMA0GCSqGSIb3DQEBAQUAA4HLADCBxwKBgQCMdauT2revYJrutp7eqQfrMkse</span><br><span class="line">TqfgRdLlMddaVRxiG04qJneVtpzkeLQTZqniJWx5YsUwMDeISeQjmVkr2a+Ob9S8</span><br><span class="line">+xsqVQ0XTW3xPjwKaZhW8jXAlX13ClhAxk1FvPbl6ASsPGUMX6gRSXArRYFx3Kev</span><br><span class="line">C9xng/ZKEhsC5FzBBwJBALKsZCm9FGHXvyJChFDt7vDZUCyU1jbOgS9EhNz+HrrU</span><br><span class="line">K9OCgOoZGfcjIHAcrM+w4AdF48NQELqttmKlcko6ock=</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure>
<p>openssl读取公钥</p>
<p><code>openssl rsa -pubin -in public.pem</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e = <span class="number">9357885447383373532894895505085381556066479232870333782284357317530689434635519527644215046975239651802146048650000941858355721661518511867620441456288201</span></span><br><span class="line">n = <span class="number">98634120039089098694716541094010585689286433311349526663366541706397717606400616707193452046001090589663396231287196347120718771479123852243352063594083947086372781079441835003204477521976780690108126553882967223715412003897334440698277808850595475155858935951484345749354296015842014107721137899755292901639</span></span><br></pre></td></tr></table></figure>
<p>提取出了n,e，但分解不出来</p>
<p>注意到<code>random.seed(int(time.time()))</code></p>
<blockquote>
<p>The seed was used is <code>int(time.time())</code> and converted into .pem file so we can use command to find time</p>
<p>给了公钥和p,q的生成方法，是用时间作种子，求利用random来求的。根据题目文件的时间向前可以爆破出来。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">stat -c &#x27;%n %y&#x27; public_key.pem</span><br></pre></td></tr></table></figure>
<p>看这里复习一下stat命令 <a target="_blank" rel="noopener" href="https://blog.csdn.net/u012294618/article/details/72630092">https://blog.csdn.net/u012294618/article/details/72630092</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pubkey = RSA.import_key(<span class="built_in">open</span>(<span class="string">&quot;public_key.pem&quot;</span>, <span class="string">&quot;r&quot;</span>).read())</span><br><span class="line">c = bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line">time_i = <span class="built_in">int</span>(time.mktime((<span class="number">2024</span>, <span class="number">9</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">18</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(time_i, <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    random.seed(i)</span><br><span class="line">    p, q = getPrime(<span class="number">512</span>, random.randbytes), getPrime(<span class="number">512</span>, random.randbytes)</span><br><span class="line">    <span class="keyword">if</span> p*q == pubkey.n:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">d = <span class="built_in">pow</span>(pubkey.e, -<span class="number">1</span>, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, pubkey.n)))</span><br></pre></td></tr></table></figure>
<h2 id="textbook-schnorr-right"><a class="markdownIt-Anchor" href="#textbook-schnorr-right"></a> Textbook Schnorr right??</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EllipticCurveCrypto</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Elliptic Curve Cryptography using the secp256k1 curve.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.p = [&lt;REDACTED&gt;]</span><br><span class="line">        self.q = [&lt;REDACTED&gt;]</span><br><span class="line">        self.K = GF(self.p)</span><br><span class="line">        self.a = self.K([&lt;REDACTED&gt;])</span><br><span class="line">        self.b = self.K([&lt;REDACTED&gt;])</span><br><span class="line">        self.curve = EllipticCurve(self.K, [self.a, self.b])</span><br><span class="line">        self.generator = self.curve(</span><br><span class="line">            [&lt;REDACTED&gt;],</span><br><span class="line">            [&lt;REDACTED&gt;],</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># Generate private and public keys</span></span><br><span class="line">        self.private_key = secrets.randbelow(self.q)</span><br><span class="line">        self.public_key = self.private_key * self.generator</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Public Key: <span class="subst">&#123;self.public_key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bytes_to_int</span>(<span class="params">b</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(b, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">int_to_bytes</span>(<span class="params">i</span>):</span><br><span class="line">        <span class="keyword">return</span> i.to_bytes((i.bit_length() + <span class="number">7</span>) // <span class="number">8</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute_hash</span>(<span class="params">self, target</span>):</span><br><span class="line">        hash_int = <span class="built_in">int</span>(hashlib.sha256(<span class="built_in">str</span>(target).encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">return</span> hash_int % self.q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, message</span>):</span><br><span class="line">        r = secrets.randbelow(self.q)</span><br><span class="line">        R = r * self.generator</span><br><span class="line">        R_int = <span class="built_in">int</span>(R.xy()[<span class="number">0</span>] + R.xy()[<span class="number">1</span>])</span><br><span class="line">        h = self.compute_hash(R_int | message)</span><br><span class="line">        s = (r + self.private_key * h) % self.q</span><br><span class="line">        <span class="keyword">return</span> s, R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, message, signature</span>):</span><br><span class="line">        s, R = signature</span><br><span class="line">        R_int = <span class="built_in">int</span>(R.xy()[<span class="number">0</span>] + R.xy()[<span class="number">1</span>])</span><br><span class="line">        h = self.compute_hash(R_int | message)</span><br><span class="line">        left_side = s * self.generator</span><br><span class="line">        right_side = R + h * self.public_key</span><br><span class="line">        <span class="keyword">return</span> left_side == right_side</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TimeoutInput</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">TimeoutError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Custom exception for input timeout.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timeout_handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">        <span class="keyword">raise</span> TimeoutInput.TimeoutError(<span class="string">&quot;Input timed out!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_input</span>(<span class="params">prompt, timeout=<span class="number">10</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Get user input with a timeout.</span></span><br><span class="line"><span class="string">        :param prompt: The prompt to display to the user.</span></span><br><span class="line"><span class="string">        :param timeout: The time limit for input in seconds.</span></span><br><span class="line"><span class="string">        :return: The user&#x27;s input as a string.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Set the signal for a timeout</span></span><br><span class="line">        signal.signal(signal.SIGALRM, TimeoutInput.timeout_handler)</span><br><span class="line">        signal.alarm(timeout)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_input = <span class="built_in">input</span>(prompt)</span><br><span class="line">            signal.alarm(<span class="number">0</span>)  <span class="comment"># Cancel the timer</span></span><br><span class="line">            <span class="keyword">return</span> user_input</span><br><span class="line">        <span class="keyword">except</span> TimeoutInput.TimeoutError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;No input received within the time limit.&quot;</span>)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">display_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Read and display the flag from the &#x27;flag.txt&#x27; file.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            flag = f.read().strip()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Congratulations! Your flag is: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag file not found.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_message</span>(<span class="params">separator, words, signature, ecc_instance</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Verify the provided signature for the message constructed from words and separator.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    message_bytes = separator.join(word.encode() <span class="keyword">for</span> word <span class="keyword">in</span> words) + separator</span><br><span class="line">    message_int = <span class="built_in">int</span>.from_bytes(message_bytes, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ecc_instance.verify(message_int, signature):</span><br><span class="line">        display_flag()</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Verification failed.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Initialize the elliptic curve cryptography instance</span></span><br><span class="line">    ecc = EllipticCurveCrypto()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Test the signing and verification process</span></span><br><span class="line">    test_message = ecc.bytes_to_int(<span class="string">&quot;test&quot;</span>.encode())</span><br><span class="line">    s_test, R_test = ecc.sign(test_message)</span><br><span class="line">    <span class="keyword">assert</span> ecc.verify(test_message, (s_test, R_test))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Regular expression patterns for input validation</span></span><br><span class="line">    separator_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^[0-9a-fA-F]&#123;2&#125;$&#x27;</span>)</span><br><span class="line">    word_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^[0-9a-fA-F]&#123;6&#125;$&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get separator input</span></span><br><span class="line">    separator_hex = TimeoutInput.get_input(<span class="string">&quot;Enter separator as a hex value (2 digits): &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> separator_pattern.<span class="keyword">match</span>(separator_hex):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid separator format.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    separator = <span class="built_in">bytes</span>.fromhex(separator_hex)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get words input</span></span><br><span class="line">    words_hex = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        prompt = <span class="string">f&quot;Enter 3-letter word <span class="subst">&#123;i + <span class="number">1</span>&#125;</span> as a hex value (6 digits): &quot;</span></span><br><span class="line">        word_hex = TimeoutInput.get_input(prompt)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word_pattern.<span class="keyword">match</span>(word_hex):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid word format.&quot;</span>)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        words_hex.append(word_hex)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        words = [<span class="built_in">bytes</span>.fromhex(word_hex).decode(<span class="string">&#x27;ascii&#x27;</span>) <span class="keyword">for</span> word_hex <span class="keyword">in</span> words_hex]</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid ASCII encoding in words.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(<span class="built_in">len</span>(word) != <span class="number">3</span> <span class="keyword">for</span> word <span class="keyword">in</span> words):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Words must be 3-letter ASCII words.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get signature components</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        hex_x_R = <span class="built_in">input</span>(<span class="string">&quot;Enter the x-coordinate of signature R (in hex): &quot;</span>)</span><br><span class="line">        x_R = <span class="built_in">int</span>(hex_x_R, <span class="number">16</span>)</span><br><span class="line">        hex_y_R = <span class="built_in">input</span>(<span class="string">&quot;Enter the y-coordinate of signature R (in hex): &quot;</span>)</span><br><span class="line">        y_R = <span class="built_in">int</span>(hex_y_R, <span class="number">16</span>)</span><br><span class="line">        hex_signature_s = <span class="built_in">input</span>(<span class="string">&quot;Enter signature s (in hex): &quot;</span>)</span><br><span class="line">        signature_s = <span class="built_in">int</span>(hex_signature_s, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid input for signature components.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt; signature_s &lt; ecc.q):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Illegal value of s.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Construct the point R</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        R = ecc.curve(x_R, y_R)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Point R does not lie on the curve.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Verify the message and signature</span></span><br><span class="line">    verify_message(separator, words, (signature_s, R), ecc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>这个题用了schnorr-digital-signature数字签名算法</p>
<p>它是将经典的<a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/schnorr-digital-signature/">schnorr数字签名算法</a>移到secp256k1椭圆曲线上</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 经典Schnorr签名算法</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个大素数 p 和它的大素因子 q</span></span><br><span class="line">p = <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000001</span>  <span class="comment"># 一个大素数</span></span><br><span class="line">q = <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141</span>  <span class="comment"># 大素因子</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个原根 g</span></span><br><span class="line">g = <span class="number">2</span>  <span class="comment"># 通常选择 2 作为原根</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成签名者的私钥 a 和公钥 A</span></span><br><span class="line">a = random.randint(<span class="number">1</span>, q - <span class="number">1</span>)  <span class="comment"># 私钥 a</span></span><br><span class="line">A = <span class="built_in">pow</span>(g, a, p)  <span class="comment"># 公钥 A</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哈希函数 H</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_message</span>(<span class="params">message, x</span>):</span><br><span class="line">    combined = <span class="string">f&quot;<span class="subst">&#123;message&#125;</span><span class="subst">&#123;x&#125;</span>&quot;</span>.encode()</span><br><span class="line">    h = hashlib.sha256(combined).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(h, <span class="number">16</span>) % q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 签名函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">message, a, g, p, q</span>):</span><br><span class="line">    r = random.randint(<span class="number">1</span>, q - <span class="number">1</span>)  <span class="comment"># 随机数 r</span></span><br><span class="line">    X = <span class="built_in">pow</span>(g, r, p)  <span class="comment"># 计算 X</span></span><br><span class="line">    e = hash_message(message, X)  <span class="comment"># 计算 e</span></span><br><span class="line">    s = (r + a * e) % q  <span class="comment"># 计算 s</span></span><br><span class="line">    <span class="keyword">return</span> (e, s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">message, signature, A, g, p, q</span>):</span><br><span class="line">    e, s = signature</span><br><span class="line">    X_prime = (<span class="built_in">pow</span>(A, e, p) * <span class="built_in">pow</span>(g, s, p)) % p  <span class="comment"># 计算 X&#x27;</span></span><br><span class="line">    e_prime = hash_message(message, X_prime)  <span class="comment"># 计算 e&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> e_prime == e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例消息</span></span><br><span class="line">message = <span class="string">&quot;Hello, Schnorr!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成签名</span></span><br><span class="line">signature = sign(message, a, g, p, q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证签名</span></span><br><span class="line">is_valid = verify(message, signature, A, g, p, q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Signature is <span class="subst">&#123;<span class="string">&#x27;valid&#x27;</span> <span class="keyword">if</span> is_valid <span class="keyword">else</span> <span class="string">&#x27;invalid&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># 椭圆曲线上的Schnorr签名</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 secp256k1 椭圆曲线参数</span></span><br><span class="line">p = <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F</span></span><br><span class="line">q = <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141</span></span><br><span class="line">curve = EllipticCurve(GF(p), [<span class="number">0</span>, <span class="number">7</span>])</span><br><span class="line">G = curve(<span class="number">0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798</span>, <span class="number">0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成私钥</span></span><br><span class="line">private_key = Integer(get_random_bytes(<span class="number">32</span>).<span class="built_in">hex</span>(), base=<span class="number">16</span>) % q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算公钥</span></span><br><span class="line">public_key = private_key * G</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_message</span>(<span class="params">message, x</span>):</span><br><span class="line">    combined = <span class="string">f&quot;<span class="subst">&#123;message&#125;</span><span class="subst">&#123;x&#125;</span>&quot;</span>.encode()</span><br><span class="line">    h = SHA256.new(combined).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(h, <span class="number">16</span>) % q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">message, private_key, G, q</span>):</span><br><span class="line">    <span class="comment"># 选择随机数 r</span></span><br><span class="line">    r = Integer(get_random_bytes(<span class="number">32</span>).<span class="built_in">hex</span>(), base=<span class="number">16</span>) % q</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算点 R</span></span><br><span class="line">    R = r * G</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算挑战值 e</span></span><br><span class="line">    e = hash_message(message, R.xy()[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算签名分量 s</span></span><br><span class="line">    s = (r + e * private_key) % q</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (R.xy()[<span class="number">0</span>], s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">message, signature, public_key, G, q</span>):</span><br><span class="line">    x_R, s = signature</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算挑战值 e</span></span><br><span class="line">    e = hash_message(message, x_R)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算验证点 U</span></span><br><span class="line">    U = s * G - e * public_key</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查验证点的 x 坐标是否等于签名中的 x_R</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(U.xy()[<span class="number">0</span>]) == x_R</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例消息</span></span><br><span class="line">message = <span class="string">&quot;Hello, Schnorr!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成签名</span></span><br><span class="line">signature = sign(message, private_key, G, q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证签名</span></span><br><span class="line">is_valid = verify(message, signature, public_key, G, q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Signature is <span class="subst">&#123;<span class="string">&#x27;valid&#x27;</span> <span class="keyword">if</span> is_valid <span class="keyword">else</span> <span class="string">&#x27;invalid&#x27;</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>可以看出题目给出的Schnorr签名算法问题出在<code>compute_hash</code>函数上</p>
<p>正常的算法中<code>e = H(M||X)</code> where H() is the hash function</p>
<p>而题目给出的是<code>e = H(M|X)</code></p>
<p>所以当输入为全1时得到的hash为固定值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">separator = <span class="string">&quot;FF&quot;</span></span><br><span class="line">payload = <span class="string">&quot;7F7F7F&quot;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter separator as a hex value (2 digits): &quot;</span>, separator.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 1 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 2 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 3 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 4 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 5 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 6 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 7 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter 3-letter word 8 as a hex value (6 digits): &quot;</span>,payload.encode().strip())</span><br><span class="line"></span><br><span class="line">TARGET = <span class="number">0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">MESSAGE_OR_MASK = <span class="built_in">int</span>(<span class="string">&quot;7F7F7FFF&quot;</span> * <span class="number">8</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_hash</span>(<span class="params">target</span>):</span><br><span class="line">    hash_int = <span class="built_in">int</span>(hashlib.sha256(<span class="built_in">str</span>(target).encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> hash_int % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_sig</span>(<span class="params">s, R_test</span>):</span><br><span class="line">    R_test_str = <span class="built_in">str</span>(R_test).strip(<span class="string">&quot;()&quot;</span>)</span><br><span class="line">    R_test_parts = [part.strip() <span class="keyword">for</span> part <span class="keyword">in</span> R_test_str.split(<span class="string">&quot;:&quot;</span>)]</span><br><span class="line">    xR = R_test_parts[<span class="number">0</span>]</span><br><span class="line">    yR = R_test_parts[<span class="number">1</span>]</span><br><span class="line">    sendxR = <span class="built_in">hex</span>(xR)[<span class="number">2</span>:]</span><br><span class="line">    sendyR = <span class="built_in">hex</span>(yR)[<span class="number">2</span>:]</span><br><span class="line">    send_s = <span class="built_in">hex</span>(s)[<span class="number">2</span>:]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;sendxR = &#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;sendyR = &#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;send_s = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Enter the x-coordinate of signature R (in hex):&quot;</span>, sendxR)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Enter the y-coordinate of signature R (in hex):&quot;</span>, sendyR)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;EEnter signature s (in hex): &quot;</span>, send_s)</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bruforce_signature</span>(<span class="params">P, G</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Brute-forcing to find a valid signature...&quot;</span>)</span><br><span class="line">    h = compute_hash(TARGET)</span><br><span class="line">    hP = h*P</span><br><span class="line">    s = secrets.randbelow(n)</span><br><span class="line">    sG = s*G</span><br><span class="line">    <span class="keyword">with</span> tqdm(total=<span class="number">0</span>, unit=<span class="string">&#x27; iterations&#x27;</span>, unit_scale=<span class="literal">True</span>) <span class="keyword">as</span> pbar:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            R_test = sG - hP</span><br><span class="line">            R_test_binary = <span class="built_in">int</span>(R_test.xy()[<span class="number">0</span>] + R_test.xy()[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">if</span> (R_test_binary | MESSAGE_OR_MASK) == TARGET:</span><br><span class="line">                <span class="keyword">assert</span> s*G - h*P == R_test</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;found&quot;</span>)</span><br><span class="line">                verify_sig(s, R_test)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            s = (s*<span class="number">2</span>) %n</span><br><span class="line">            sG = <span class="number">2</span>*sG</span><br><span class="line">            pbar.update(<span class="built_in">int</span>(<span class="number">1</span>))</span><br><span class="line">bruforce_signature(P, G)</span><br></pre></td></tr></table></figure>
<h2 id="hard-to-implement"><a class="markdownIt-Anchor" href="#hard-to-implement"></a> Hard to Implement</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> external <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> socketserver, signal</span><br><span class="line"> </span><br><span class="line">listen = <span class="number">1337</span></span><br><span class="line">attempts = <span class="number">1500</span></span><br><span class="line">flag = getflag()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key,plaintext</span>):</span><br><span class="line">	cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">	pt = pad(plaintext + flag.encode(), <span class="number">16</span>)</span><br><span class="line">	<span class="keyword">return</span> cipher.encrypt(pt).<span class="built_in">hex</span>()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve</span>(<span class="params">req</span>):</span><br><span class="line">	key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line">	tries = <span class="number">0</span></span><br><span class="line">	req.sendall(<span class="string">b&quot;Thank you for using our secure communications channel.\nThis channel uses top-shelf military-grade encryption.\nIf you are not the intended recepient, you can&#x27;t read our secret.&quot;</span>)</span><br><span class="line">	<span class="keyword">while</span> tries &lt; attempts:</span><br><span class="line">		req.sendall(<span class="string">b&#x27;\n(&#x27;</span>+<span class="built_in">str</span>.encode(<span class="built_in">str</span>(tries))+<span class="string">b&#x27;/&#x27;</span>+<span class="built_in">str</span>.encode(<span class="built_in">str</span>(attempts))+<span class="string">b&#x27;) &#x27;</span>)</span><br><span class="line">		req.sendall(<span class="string">b&#x27;Send challenge &gt; &#x27;</span>)</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			ct = encrypt(key, req.recv(<span class="number">4096</span>).strip(<span class="string">b&#x27;\n&#x27;</span>))</span><br><span class="line">			req.sendall(<span class="string">b&quot;Response &gt; &quot;</span> + ct.encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">		<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">			req.sendall(<span class="string">b&quot;An error occured!\n&quot;</span>)</span><br><span class="line">		tries += <span class="number">1</span></span><br><span class="line">	req.sendall(<span class="string">b&#x27;\nMax attempts exceeded, have a good day.\n&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">incoming</span>(socketserver.BaseRequestHandler):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">		signal.alarm(<span class="number">1500</span>)</span><br><span class="line">		req = self.request</span><br><span class="line">		serve(req)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	socketserver.TCPServer.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">	server = ReusableTCPServer((<span class="string">&quot;0.0.0.0&quot;</span>, listen), incoming)</span><br><span class="line">	server.serve_forever()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>AES ECB的padding oracle:  <a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/11/07/crypto-%E5%9D%97%E5%AF%86%E7%A0%81/#%E6%A8%A1%E5%BC%8F%E6%94%BB%E5%87%BB-1">块密码 | Lazzaro (lazzzaro.github.io)</a></p>
<blockquote>
<p>1.由于是ECB的模式，所以当我们输入十五个’0’后，服务会将十五个<code>’0’+flag</code>加密，而此时第一组就是十五个’0’和flag的第一个字符。即，返回的明文的第一组是<code>’0’*15 + flag[0]</code>的密文。</p>
<p>2.我们遍历0-255，发送<code>’0’*15+chr(i)</code>，看返回的密文是不是和最初获得的密文的第一组一致，如果一致，那么此时的chr(i)就是flag的第一位。</p>
<p>3.有了第一位我们就可以发送<code>’0’*14+flag[0]</code>过去，此时返回的第一组密文就是<code>’0’*14+flag[0]+flag[1]</code>的密文了，我们继续用第2步的方法就可以恢复flag[1]了。</p>
<p>4.如此循环往复，逐位爆破flag。</p>
</blockquote>
<p>exp: [<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52640415/article/details/142500402">Patriot CTF 2024]-CSDN博客</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oracle</span>(<span class="params">data</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Send challenge &gt; &#x27;</span>, data)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;Response &gt; &quot;</span>)</span><br><span class="line">    s=r.recvline().strip().decode()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(s)</span><br><span class="line"> </span><br><span class="line">r=remote(<span class="string">&#x27;chal.competitivecyber.club&#x27;</span>, <span class="number">6001</span>)</span><br><span class="line">flag=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    padding=<span class="string">b&#x27;A&#x27;</span>*(<span class="number">32</span>-<span class="number">1</span>-i)</span><br><span class="line">    test=oracle(padding) <span class="comment">#尾部漏出flag  1个字符</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">        <span class="keyword">if</span> oracle(padding+flag+c.encode())[:<span class="number">32</span>]==test[:<span class="number">32</span>]: <span class="comment">#pad+已知的flag+猜</span></span><br><span class="line">            flag=flag+c.encode()</span><br><span class="line">            <span class="built_in">print</span>(flag, i)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://dawn1ight.github.io">dawn1ight</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://dawn1ight.github.io/post/11600/">https://dawn1ight.github.io/post/11600/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dawn1ight.github.io" target="_blank">dawn1ight 的孤岛</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WriteUP/">WriteUP</a></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/23197/" title="SHCTF2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/10/05/fvB8o4VdOgXwIcU.png" onerror="onerror=null;src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SHCTF2024 Crypto WriteUp</div></div></a></div><div class="next-post pull-right"><a href="/post/30110/" title="SCTF 2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/09/30/DgVuBbdJZW8ynmE.jpg" onerror="onerror=null;src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SCTF 2024 Crypto WriteUp</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/53861/" title="第四届“网鼎杯”网络安全大赛青龙组 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/10/29/3HIqPhO4vD5gaYS.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-29</div><div class="title">第四届“网鼎杯”网络安全大赛青龙组 Crypto WriteUp</div></div></a></div><div><a href="/post/30110/" title="SCTF 2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/09/30/DgVuBbdJZW8ynmE.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-29</div><div class="title">SCTF 2024 Crypto WriteUp</div></div></a></div><div><a href="/post/39797/" title="第八届“强网杯”全国网络安全挑战赛 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/11/04/AIWtiLF3Yr1f7GH.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-02</div><div class="title">第八届“强网杯”全国网络安全挑战赛 Crypto WriteUp</div></div></a></div><div><a href="/post/43135/" title="第十八届全国大学生信息安全竞赛暨第二届“长城杯”铁人三项赛初赛 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/12/19/9TLKXadHGwWevYP.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-18</div><div class="title">第十八届全国大学生信息安全竞赛暨第二届“长城杯”铁人三项赛初赛 Crypto WriteUp</div></div></a></div><div><a href="/post/62963/" title="2024“国城杯”网络安全挑战赛 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/12/08/98EUN2OfjLmkoqz.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-07</div><div class="title">2024“国城杯”网络安全挑战赛 Crypto WriteUp</div></div></a></div><div><a href="/post/23197/" title="SHCTF2024 Crypto WriteUp"><img class="cover" src="https://s2.loli.net/2024/10/05/fvB8o4VdOgXwIcU.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-05</div><div class="title">SHCTF2024 Crypto WriteUp</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2024/06/09/8Hyr97a4VnGmL5K.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/wNr574gd2t1MYzh.gif'" alt="avatar"/></div><div class="author-info__name">dawn1ight</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dawn1ight"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dawn1ight" target="_blank" title="Github"><i class="fab fa-github" style="color: #346c9c;"></i></a><a class="social-icon" href="mailto:dawn1ight@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #346c9c;"></i></a><a class="social-icon" href="https://f1eeg0urj5.feishu.cn/docx/doxcnpFk1I5yfY8A5CmsjJsAeOb" target="_blank" title="Feishu"><i class="fa fa-book-open" style="color: #346c9c;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到 dawn1ight 的孤岛</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#patriotctf-2024-crypto-writeup"><span class="toc-number">1.</span> <span class="toc-text"> PatriotCTF 2024 Crypto Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bigger-is-better"><span class="toc-number">1.1.</span> <span class="toc-text"> Bigger is Better</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#idk-cipher"><span class="toc-number">1.2.</span> <span class="toc-text"> idk cipher</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#high-roller"><span class="toc-number">1.3.</span> <span class="toc-text"> High Roller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#textbook-schnorr-right"><span class="toc-number">1.4.</span> <span class="toc-text"> Textbook Schnorr right??</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hard-to-implement"><span class="toc-number">1.5.</span> <span class="toc-text"> Hard to Implement</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/30479/" title="第十九届全国大学生信息安全竞赛 Crypto WriteUp"><img src="https://s2.loli.net/2025/12/29/g2OGhHyLcTjUN8n.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="第十九届全国大学生信息安全竞赛 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/30479/" title="第十九届全国大学生信息安全竞赛 Crypto WriteUp">第十九届全国大学生信息安全竞赛 Crypto WriteUp</a><time datetime="2025-12-28T16:00:00.000Z" title="发表于 2025-12-29 00:00:00">2025-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/43135/" title="第十八届全国大学生信息安全竞赛暨第二届“长城杯”铁人三项赛初赛 Crypto WriteUp"><img src="https://s2.loli.net/2024/12/19/9TLKXadHGwWevYP.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="第十八届全国大学生信息安全竞赛暨第二届“长城杯”铁人三项赛初赛 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/43135/" title="第十八届全国大学生信息安全竞赛暨第二届“长城杯”铁人三项赛初赛 Crypto WriteUp">第十八届全国大学生信息安全竞赛暨第二届“长城杯”铁人三项赛初赛 Crypto WriteUp</a><time datetime="2024-12-17T16:00:00.000Z" title="发表于 2024-12-18 00:00:00">2024-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/62963/" title="2024“国城杯”网络安全挑战赛 Crypto WriteUp"><img src="https://s2.loli.net/2024/12/08/98EUN2OfjLmkoqz.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="2024“国城杯”网络安全挑战赛 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/62963/" title="2024“国城杯”网络安全挑战赛 Crypto WriteUp">2024“国城杯”网络安全挑战赛 Crypto WriteUp</a><time datetime="2024-12-06T16:00:00.000Z" title="发表于 2024-12-07 00:00:00">2024-12-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/39797/" title="第八届“强网杯”全国网络安全挑战赛 Crypto WriteUp"><img src="https://s2.loli.net/2024/11/04/AIWtiLF3Yr1f7GH.jpg" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="第八届“强网杯”全国网络安全挑战赛 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/39797/" title="第八届“强网杯”全国网络安全挑战赛 Crypto WriteUp">第八届“强网杯”全国网络安全挑战赛 Crypto WriteUp</a><time datetime="2024-11-01T16:00:00.000Z" title="发表于 2024-11-02 00:00:00">2024-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/53861/" title="第四届“网鼎杯”网络安全大赛青龙组 Crypto WriteUp"><img src="https://s2.loli.net/2024/10/29/3HIqPhO4vD5gaYS.webp" onerror="this.onerror=null;this.src='https://s2.loli.net/2024/06/09/bEoXpqyOczZW9G7.jpg'" alt="第四届“网鼎杯”网络安全大赛青龙组 Crypto WriteUp"/></a><div class="content"><a class="title" href="/post/53861/" title="第四届“网鼎杯”网络安全大赛青龙组 Crypto WriteUp">第四届“网鼎杯”网络安全大赛青龙组 Crypto WriteUp</a><time datetime="2024-10-28T16:00:00.000Z" title="发表于 2024-10-29 00:00:00">2024-10-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2024/06/09/l9xkjgDWpeo4mRE.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2026 By dawn1ight</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">没有销声匿迹，我在热爱生活。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="/true"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(()=>{
  const getGiscusTheme = theme => {
    return theme === 'dark' ? 'dark' : 'light'
  }

  const loadGiscus = () => {
    const config = Object.assign({
      src: 'https://giscus.app/client.js',
      'data-repo': 'dawn1ight/dawn1ight.github.io',
      'data-repo-id': 'R_kgDOMFWO7A',
      'data-category-id': 'DIC_kwDOMFWO7M4ClmnO',
      'data-mapping': 'pathname',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true
    },null)

    const ele = document.createElement('script')
    for (let key in config) {
      ele.setAttribute(key, config[key])
    }
    document.getElementById('giscus-wrap').appendChild(ele)
  }

  const changeGiscusTheme = theme => {
    const sendMessage = message => {
      const iframe = document.querySelector('iframe.giscus-frame')
      if (!iframe) return
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
    }

    sendMessage({
      setConfig: {
        theme: getGiscusTheme(theme)
      }
    });
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment= loadGiscus
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>